<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üèÜ</text></svg>" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>TalkMaster ‚Äì English Conversations Reimagined</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      // Apply dark mode immediately to prevent flash of light mode
      if (localStorage.getItem('theme') === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
        document.documentElement.classList.add('dark');
      } else {
        document.documentElement.classList.remove('dark');
      }
    </script>
  <script type="importmap">
{
  "imports": {
    "@google/genai": "https://aistudiocdn.com/@google/genai@^1.27.0",
    "react/": "https://aistudiocdn.com/react@^19.2.0/",
    "react": "https://aistudiocdn.com/react@^19.2.0",
    "react-dom/": "https://aistudiocdn.com/react-dom@^19.2.0/"
  }
}
</script>
<style>
      body {
        font-family: 'Inter', sans-serif;
        overscroll-behavior: none;
        background-color: #f0f4f8; /* Light mode fallback */
      }
      .dark body {
        background-color: #0b1120; /* Dark mode fallback */
      }

      .toast-enter {
        animation: slideInUp 0.5s cubic-bezier(0.250, 0.460, 0.450, 0.940) both;
      }
      .toast-exit {
        animation: slideOutDown 0.5s cubic-bezier(0.550, 0.085, 0.680, 0.530) both;
      }
      @keyframes slideInUp {
        0% { transform: translateY(100px); opacity: 0; }
        100% { transform: translateY(0); opacity: 1; }
      }
      @keyframes slideOutDown {
        0% { transform: translateY(0); opacity: 1; }
        100% { transform: translateY(100px); opacity: 0; }
      }
      .animate-fadeIn {
        animation: fadeIn 0.5s ease-in-out forwards;
        opacity: 0;
      }
      .animate-fadeIn-delay { animation-delay: 100ms; }
      .animate-fadeIn-delay-2 { animation-delay: 200ms; }
      .animate-fadeIn-delay-3 { animation-delay: 300ms; }

      @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
      }
      /* 3D Flip Animation for Flashcards */
      .flashcard-container {
        perspective: 1000px;
      }
      .flashcard {
        transition: transform 0.6s;
        transform-style: preserve-d;
      }
      .flashcard.is-flipped {
        transform: rotateY(180deg);
      }
      .flashcard-face {
        -webkit-backface-visibility: hidden;
        backface-visibility: hidden;
      }
      .flashcard-back {
        transform: rotateY(180deg);
      }

      /* Custom Scenario Modal Animation */
      .modal-overlay {
        animation: fadeIn 0.3s ease-out;
      }
      .modal-content {
        animation: scaleUp 0.3s ease-out;
      }
      @keyframes scaleUp {
        from { transform: scale(0.95); opacity: 0; }
        to { transform: scale(1); opacity: 1; }
      }
      
      .message-enter {
        animation: slideInUp-message 0.4s cubic-bezier(0.250, 0.460, 0.450, 0.940) both;
      }
      @keyframes slideInUp-message {
        0% { transform: translateY(20px); opacity: 0; }
        100% { transform: translateY(0); opacity: 1; }
      }

      .pulse-glow {
        animation: pulse-glow 2.5s infinite ease-in-out;
      }
      @keyframes pulse-glow {
        0%, 100% {
            box-shadow: 0 0 0 0 rgba(167, 139, 250, 0.5);
        }
        50% {
            box-shadow: 0 0 20px 10px rgba(167, 139, 250, 0);
        }
      }

      @keyframes thinking-pulse {
        0%, 100% { transform: scale(1); opacity: 1; }
        50% { transform: scale(1.1); opacity: 0.9; }
      }
      .animate-thinking-pulse {
        animation: thinking-pulse 1.5s infinite ease-in-out;
      }
      
      @keyframes breathing {
        0%, 100% { transform: scale(1); }
        50% { transform: scale(1.02); }
      }
      .animate-breathing {
        animation: breathing 4s infinite ease-in-out;
      }

      /* New Sparkle/Glow Animation */
      .achievement-sparkle {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 9999;
        pointer-events: none;
        overflow: hidden;
      }
      .achievement-sparkle::before {
        content: '';
        position: absolute;
        top: 50%;
        left: 50%;
        width: 800px;
        height: 800px;
        background: radial-gradient(circle, rgba(251, 191, 36, 0.4) 0%, rgba(251, 191, 36, 0) 70%);
        border-radius: 50%;
        transform: translate(-50%, -50%) scale(0);
        animation: glow-burst 1.5s ease-out forwards;
      }
      @keyframes glow-burst {
        0% { transform: translate(-50%, -50%) scale(0); opacity: 1; }
        50% { transform: translate(-50%, -50%) scale(1.2); opacity: 0.5; }
        100% { transform: translate(-50%, -50%) scale(2); opacity: 0; }
      }
      .pulse-glow-button {
        animation: pulse-glow-button 2s infinite ease-in-out;
      }
       @keyframes pulse-glow-button {
        0%, 100% {
            box-shadow: 0 0 0 0 rgba(99, 102, 241, 0.4);
        }
        70% {
            box-shadow: 0 0 20px 10px rgba(99, 102, 241, 0);
        }
      }

      /* Learning Journey Path */
      .journey-line::before {
          content: '';
          position: absolute;
          top: 30px; /* vertically center on the node icon */
          left: 8%;
          right: 8%;
          height: 4px;
          background-image: linear-gradient(to right, #94a3b8 50%, transparent 50%); /* dashed effect */
          background-size: 20px 4px;
          z-index: 1;
      }
      .dark .journey-line::before {
          background-image: linear-gradient(to right, #475569 50%, transparent 50%);
      }

      /* New Animated Gradient Backgrounds */
      #app-background-light, #app-background-dark {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: -1;
        background-size: 400% 400%;
        animation: gradient-animation 25s ease infinite;
      }
      
      #app-background-light {
          background: linear-gradient(135deg, #e0f7fa, #d1c4e9, #f3e5f5, #e0f2f1);
          display: block;
      }
      .dark #app-background-light {
          display: none;
      }

      #app-background-dark {
        background: linear-gradient(135deg, #020617, #1e1b4b, #0f172a, #3730a3);
        display: none;
      }
      .dark #app-background-dark {
        display: block;
      }
      
      @keyframes gradient-animation {
          0% { background-position: 0% 50%; }
          50% { background-position: 100% 50%; }
          100% { background-position: 0% 50%; }
      }
      
      /* Neumorphic Shadows */
      .neumorph-shadow-light {
        box-shadow: 6px 6px 12px #c5c9cc, -6px -6px 12px #ffffff;
      }
       .neumorph-shadow-light-inset {
        box-shadow: inset 6px 6px 12px #c5c9cc, inset -6px -6px 12px #ffffff;
      }
      .dark .neumorph-shadow-dark {
        box-shadow: 6px 6px 12px #080c16, -6px -6px 12px #1a2642;
      }
       .dark .neumorph-shadow-dark-inset {
        box-shadow: inset 6px 6px 12px #080c16, inset -6px -6px 12px #1a2642;
      }

      /* Immersive Conversation View styles */
      .conversation-background {
        animation: ken-burns 30s ease-out infinite;
        transform-origin: center center;
      }
       @keyframes ken-burns {
        0% { transform: scale(1.1); }
        50% { transform: scale(1); }
        100% { transform: scale(1.1); }
       }
       
      .glassmorphism {
        background: rgba(17, 24, 39, 0.3);
        -webkit-backdrop-filter: blur(12px);
        backdrop-filter: blur(12px);
        border-top: 1px solid rgba(255, 255, 255, 0.1);
      }
      .dark .glassmorphism {
        background: rgba(2, 6, 23, 0.5);
      }

      @keyframes voice-wave {
        0%, 100% { box-shadow: 0 0 0 0 rgba(255, 255, 255, 0.3); }
        50% { box-shadow: 0 0 0 10px rgba(255, 255, 255, 0); }
      }
      .animate-voice-wave {
          animation: voice-wave 2s infinite;
      }

      @keyframes waveform-bar {
        0% { height: 2px; }
        50% { height: 100%; }
        100% { height: 2px; }
      }
      .waveform-bar {
        animation: waveform-bar 1.2s infinite ease-in-out;
      }
      
      @keyframes glowing-star {
        0%, 100% { filter: drop-shadow(0 0 2px #facc15); transform: scale(1); }
        50% { filter: drop-shadow(0 0 10px #facc15); transform: scale(1.2); }
      }
      .animate-glowing-star {
        animation: glowing-star 1.5s ease-in-out;
      }

      /* Onboarding Animations */
      @keyframes moving-glow {
        0% { transform: translate(-50%, -50%) rotate(0deg) scale(1); }
        25% { transform: translate(-40%, -60%) rotate(90deg) scale(1.2); }
        50% { transform: translate(-50%, -50%) rotate(180deg) scale(1); }
        75% { transform: translate(-60%, -40%) rotate(270deg) scale(1.2); }
        100% { transform: translate(-50%, -50%) rotate(360deg) scale(1); }
      }
      @keyframes avatar-pulse {
        0%, 100% { box-shadow: 0 0 0 0 rgba(196, 181, 253, 0.4); }
        50% { box-shadow: 0 0 25px 10px rgba(196, 181, 253, 0); }
      }

      /* Custom Scrollbar for Modal */
      .modal-scroll::-webkit-scrollbar {
        width: 8px;
      }
      .modal-scroll::-webkit-scrollbar-track {
        background: rgba(255, 255, 255, 0.1);
        border-radius: 10px;
      }
      .modal-scroll::-webkit-scrollbar-thumb {
        background: rgba(170, 170, 170, 0.4);
        border-radius: 10px;
      }
      .modal-scroll::-webkit-scrollbar-thumb:hover {
        background: rgba(170, 170, 170, 0.6);
      }
    </style>
</head>
  <body>
    <div id="app-background-light"></div>
    <div id="app-background-dark"></div>
    <div id="root"></div>
    <script type="module">
import React, { useState, useEffect, useCallback, useRef, useMemo } from 'react';
import ReactDOM from 'react-dom/client';
import { GoogleGenAI, Modality, Type } from "@google/genai";

// types.ts
var UserLevel;
(function (UserLevel) {
    UserLevel["Beginner"] = "Beginner";
    UserLevel["Intermediate"] = "Intermediate";
    UserLevel["Advanced"] = "Advanced";
})(UserLevel || (UserLevel = {}));
var Speaker;
(function (Speaker) {
    Speaker["User"] = "user";
    Speaker["Bot"] = "bot";
})(Speaker || (Speaker = {}));
var View;
(function (View) {
    View[View["DASHBOARD"] = 0] = "DASHBOARD";
    View[View["SCENARIO_SELECTION"] = 1] = "SCENARIO_SELECTION";
    View[View["CONVERSATION"] = 2] = "CONVERSATION";
    View[View["CONVERSATION_SUMMARY"] = 3] = "CONVERSATION_SUMMARY";
    View[View["LEARN_REVIEW"] = 4] = "LEARN_REVIEW";
    View[View["SETTINGS"] = 5] = "SETTINGS";
})(View || (View = {}));
var InteractionMode;
(function (InteractionMode) {
    InteractionMode["LIVE"] = "live";
    InteractionMode["TEXT"] = "text";
})(InteractionMode || (InteractionMode = {}));
var ConversationStatus;
(function (ConversationStatus) {
    ConversationStatus["IDLE"] = "Select a scenario to start";
    ConversationStatus["CONNECTING"] = "Connecting...";
    ConversationStatus["LISTENING"] = "Listening...";
    ConversationStatus["THINKING"] = "Thinking...";
    ConversationStatus["SPEAKING"] = "Speaking...";
    ConversationStatus["ERROR"] = "An error occurred. Please try again.";
    ConversationStatus["RATE_LIMIT_ERROR"] = "API rate limit reached. Please wait a moment.";
})(ConversationStatus || (ConversationStatus = {}));
var QuestType;
(function (QuestType) {
    QuestType["COMPLETE_ANY_SCENARIO"] = "COMPLETE_ANY_SCENARIO";
    QuestType["COMPLETE_SPECIFIC_SCENARIO"] = "COMPLETE_SPECIFIC_SCENARIO";
    QuestType["CONVERSE_FOR_MINUTES"] = "CONVERSE_FOR_MINUTES";
    QuestType["SAVE_VOCAB_WORDS"] = "SAVE_VOCAB_WORDS";
    QuestType["USE_SPECIFIC_WORD"] = "USE_SPECIFIC_WORD";
})(QuestType || (QuestType = {}));
var LearningGoal;
(function (LearningGoal) {
    LearningGoal["TRAVEL"] = "Travel";
    LearningGoal["CAREER"] = "Career";
    LearningGoal["SOCIAL"] = "Social";
    LearningGoal["GENERAL"] = "General Fluency";
})(LearningGoal || (LearningGoal = {}));

// components/icons.tsx
const SunIcon = (props) => (React.createElement("svg", { ...props, xmlns: "http://www.w3.org/2000/svg", width: "24", height: "24", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round" },
    React.createElement("circle", { cx: "12", cy: "12", r: "5" }),
    React.createElement("line", { x1: "12", y1: "1", x2: "12", y2: "3" }),
    React.createElement("line", { x1: "12", y1: "21", x2: "12", y2: "23" }),
    React.createElement("line", { x1: "4.22", y1: "4.22", x2: "5.64", y2: "5.64" }),
    React.createElement("line", { x1: "18.36", y1: "18.36", x2: "19.78", y2: "19.78" }),
    React.createElement("line", { x1: "1", y1: "12", x2: "3", y2: "12" }),
    React.createElement("line", { x1: "21", y1: "12", x2: "23", y2: "12" }),
    React.createElement("line", { x1: "4.22", y1: "19.78", x2: "5.64", y2: "18.36" }),
    React.createElement("line", { x1: "18.36", y1: "5.64", x2: "19.78", y2: "4.22" })));
const MoonIcon = (props) => (React.createElement("svg", { ...props, xmlns: "http://www.w3.org/2000/svg", width: "24", height: "24", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round" },
    React.createElement("path", { d: "M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z" })));
const TrophyIcon = (props) => (React.createElement("svg", { ...props, xmlns: "http://www.w3.org/2000/svg", width: "24", height: "24", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round" },
    React.createElement("path", { d: "M6 9H4.5a2.5 2.5 0 0 1 0-5H6" }),
    React.createElement("path", { d: "M18 9h1.5a2.5 2.5 0 0 0 0-5H18" }),
    React.createElement("path", { d: "M4 22h16" }),
    React.createElement("path", { d: "M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22" }),
    React.createElement("path", { d: "M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22" }),
    React.createElement("path", { d: "M18 2H6v7a6 6 0 0 0 12 0V2Z" })));
const BrainCircuitIcon = (props) => (React.createElement("svg", { ...props, xmlns: "http://www.w3.org/2000/svg", width: "24", height: "24", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round" },
    React.createElement("path", { d: "M12 5a3 3 0 1 0-5.993.129" }),
    React.createElement("path", { d: "M12 5a3 3 0 1 0 5.993.129" }),
    React.createElement("path", { d: "M15 13a3 3 0 1 0-5.993.129" }),
    React.createElement("path", { d: "M15 13a3 3 0 1 0 5.993.129" }),
    React.createElement("path", { d: "M9 13a3 3 0 1 0-5.993.129" }),
    React.createElement("path", { d: "M9.003 12.87A3 3 0 1 0 9 13h0Z" }),
    React.createElement("path", { d: "M6 8.5v4" }),
    React.createElement("path", { d: "M18 8.5v4" }),
    React.createElement("path", { d: "M12 11.5v4" }),
    React.createElement("path", { d: "M12 3.5V2" }),
    React.createElement("path", { d: "M12 19v2" }),
    React.createElement("path", { d: "m4.929 4.929-.707-.707" }),
    React.createElement("path", { d: "m19.799 19.799-.707-.707" }),
    React.createElement("path", { d: "m19.071 4.929.707-.707" }),
    React.createElement("path", { d: "m4.221 19.799.707-.707" })));
const MicIcon = (props) => (React.createElement("svg", { ...props, xmlns: "http://www.w3.org/2000/svg", width: "24", height: "24", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round" },
    React.createElement("path", { d: "M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z" }),
    React.createElement("path", { d: "M19 10v2a7 7 0 0 1-14 0v-2" }),
    React.createElement("line", { x1: "12", y1: "19", x2: "12", y2: "23" })));
const BotHeadIcon = (props) => (React.createElement("svg", { ...props, xmlns: "http://www.w3.org/2000/svg", width: "24", height: "24", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round" },
    React.createElement("path", { d: "M12 8V4H8" }),
    React.createElement("rect", { width: "16", height: "12", x: "4", y: "8", rx: "2" }),
    React.createElement("path", { d: "M2 14h2" }),
    React.createElement("path", { d: "M20 14h2" }),
    React.createElement("path", { d: "M15 13v2" }),
    React.createElement("path", { d: "M9 13v2" })));
const StopIcon = (props) => (React.createElement("svg", { ...props, xmlns: "http://www.w3.org/2000/svg", width: "24", height: "24", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round" },
    React.createElement("circle", { cx: "12", cy: "12", r: "10" }),
    React.createElement("rect", { x: "9", y: "9", width: "6", height: "6" })));
const BotIcon = (props) => (React.createElement("svg", { ...props, xmlns: "http://www.w3.org/2000/svg", width: "24", height: "24", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round" },
    React.createElement("rect", { x: "2", y: "7", width: "20", height: "14", rx: "2", ry: "2" }),
    React.createElement("path", { d: "M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16" }),
    React.createElement("circle", { cx: "8", cy: "12", r: "1" }),
    React.createElement("circle", { cx: "16", cy: "12", r: "1" })));
const UserIcon = (props) => (React.createElement("svg", { ...props, xmlns: "http://www.w3.org/2000/svg", width: "24", height: "24", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round" },
    React.createElement("path", { d: "M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2" }),
    React.createElement("circle", { cx: "12", cy: "7", r: "4" })));
const SendIcon = (props) => (React.createElement("svg", { ...props, xmlns: "http://www.w3.org/2000/svg", width: "24", height: "24", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round" },
    React.createElement("line", { x1: "22", y1: "2", x2: "11", y2: "13" }),
    React.createElement("polygon", { points: "22 2 15 22 11 13 2 9 22 2" })));
const VolumeUpIcon = (props) => (React.createElement("svg", { ...props, xmlns: "http://www.w3.org/2000/svg", width: "24", height: "24", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round" },
    React.createElement("polygon", { points: "11 5 6 9 2 9 2 15 6 15 11 19 11 5" }),
    React.createElement("path", { d: "M15.54 8.46a5 5 0 0 1 0 7.07" }),
    React.createElement("path", { d: "M19.07 4.93a10 10 0 0 1 0 14.14" })));
const VolumeOffIcon = (props) => (React.createElement("svg", { ...props, xmlns: "http://www.w3.org/2000/svg", width: "24", height: "24", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round" },
    React.createElement("polygon", { points: "11 5 6 9 2 9 2 15 6 15 11 19 11 5" }),
    React.createElement("line", { x1: "23", y1: "9", x2: "17", y2: "15" }),
    React.createElement("line", { x1: "17", y1: "9", x2: "23", y2: "15" })));
const CheckCircleIcon = (props) => (React.createElement("svg", { ...props, xmlns: "http://www.w3.org/2000/svg", width: "24", height: "24", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round" },
    React.createElement("path", { d: "M22 11.08V12a10 10 0 1 1-5.93-9.14" }),
    React.createElement("polyline", { points: "22 4 12 14.01 9 11.01" })));
const XCircleIcon = (props) => (React.createElement("svg", { ...props, xmlns: "http://www.w3.org/2000/svg", width: "24", height: "24", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round" },
    React.createElement("circle", { cx: "12", cy: "12", r: "10" }),
    React.createElement("line", { x1: "15", y1: "9", x2: "9", y2: "15" }),
    React.createElement("line", { x1: "9", y1: "9", x2: "15", y2: "15" })));
const ArrowLeftIcon = (props) => (React.createElement("svg", { ...props, xmlns: "http://www.w3.org/2000/svg", width: "24", height: "24", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round" },
    React.createElement("line", { x1: "19", y1: "12", x2: "5", y2: "12" }),
    React.createElement("polyline", { points: "12 19 5 12 12 5" })));
const BookOpenIcon = (props) => (React.createElement("svg", { ...props, xmlns: "http://www.w3.org/2000/svg", width: "24", height: "24", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round" },
    React.createElement("path", { d: "M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z" }),
    React.createElement("path", { d: "M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z" })));
const LightbulbIcon = (props) => (React.createElement("svg", { ...props, xmlns: "http://www.w3.org/2000/svg", width: "24", height: "24", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round" },
    React.createElement("path", { d: "M15 14c.2-1 .7-1.7 1.5-2.5C17.7 10.2 18 9 18 7.5a6 6 0 0 0-12 0c0 1.5.3 2.7 1.5 3.5.7.8 1.3 1.5 1.5 2.5" }),
    React.createElement("path", { d: "M9 18h6" }),
    React.createElement("path", { d: "M10 22h4" })));
const SparklesIcon = (props) => (React.createElement("svg", { ...props, xmlns: "http://www.w3.org/2000/svg", width: "24", height: "24", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round" },
    React.createElement("path", { d: "M9.93 2.93a1 1 0 0 0-1.42 1.42l3.5 3.5a1 1 0 0 0 1.42-1.42zM18.04 11.01a1 1 0 0 0-1.42 1.42l3.5 3.5a1 1 0 0 0 1.42-1.42zM2.93 9.93a1 1 0 0 0 1.42-1.42l-3.5-3.5a1 1 0 0 0-1.42 1.42zM11.01 18.04a1 1 0 0 0 1.42-1.42l-3.5-3.5a1 1 0 0 0-1.42 1.42z" }),
    React.createElement("path", { d: "m21 12-2.12 2.12M14.12 14.12 12 12M3 12l2.12-2.12M9.88 9.88 12 12" })));
const SettingsIcon = (props) => (React.createElement("svg", { ...props, xmlns: "http://www.w3.org/2000/svg", width: "24", height: "24", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round" },
    React.createElement("path", { d: "M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 0 2l-.15.08a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.38a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1 0-2l.15-.08a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z" }),
    React.createElement("circle", { cx: "12", cy: "12", r: "3" })));
const CheckIcon = (props) => (React.createElement("svg", { ...props, xmlns: "http://www.w3.org/2000/svg", width: "24", height: "24", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round" },
    React.createElement("polyline", { points: "20 6 9 17 4 12" })));
const PlusIcon = (props) => (React.createElement("svg", { ...props, xmlns: "http://www.w3.org/2000/svg", width: "24", height: "24", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round" },
    React.createElement("line", { x1: "12", y1: "5", x2: "12", y2: "19" }),
    React.createElement("line", { x1: "5", y1: "12", x2: "19", y2: "12" })));
const FlameIcon = (props) => (React.createElement("svg", { ...props, xmlns: "http://www.w3.org/2000/svg", width: "24", height: "24", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round" },
    React.createElement("path", { d: "M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z" })));
const CheckBadgeIcon = (props) => (React.createElement("svg", { ...props, xmlns: "http://www.w3.org/2000/svg", width: "24", height: "24", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round" },
    React.createElement("path", { d: "M3.85 8.62a4 4 0 0 1 4.78-4.78l1.21 1.22a1 1 0 0 0 1.42 0l1.21-1.22a4 4 0 0 1 4.78 4.78l-1.22 1.21a1 1 0 0 0 0 1.42l1.22 1.21a4 4 0 0 1-4.78 4.78l-1.21-1.22a1 1 0 0 0-1.42 0l-1.21 1.22a4 4 0 0 1-4.78-4.78l1.22-1.21a1 1 0 0 0 0-1.42z" }),
    React.createElement("path", { d: "m9 12 2 2 4-4" })));
const TargetIcon = (props) => (React.createElement("svg", { ...props, xmlns: "http://www.w3.org/2000/svg", width: "24", height: "24", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round" },
    React.createElement("circle", { cx: "12", cy: "12", r: "10" }),
    React.createElement("circle", { cx: "12", cy: "12", r: "6" }),
    React.createElement("circle", { cx: "12", cy: "12", r: "2" })));
const MessageSquareIcon = (props) => (React.createElement("svg", { ...props, xmlns: "http://www.w3.org/2000/svg", width: "24", height: "24", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round" },
    React.createElement("path", { d: "M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z" })));
const UserCheck = (props) => (React.createElement("svg", { ...props, xmlns: "http://www.w3.org/2000/svg", width: "24", height: "24", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round" },
    React.createElement("path", { d: "M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2" }),
    React.createElement("circle", { cx: "8.5", cy: "7", r: "4" }),
    React.createElement("polyline", { points: "17 11 19 13 23 9" })));
const UserCog = (props) => (React.createElement("svg", { ...props, xmlns: "http://www.w3.org/2000/svg", width: "24", height: "24", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round" },
    React.createElement("circle", { cx: "18", cy: "15", r: "3" }),
    React.createElement("circle", { cx: "9", cy: "7", r: "4" }),
    React.createElement("path", { d: "M23 21v-2a4 4 0 0 0-3-3.87" }),
    React.createElement("path", { d: "M16 3.13a4 4 0 0 1 0 7.75" }),
    React.createElement("path", { d: "M21.16 18a3 3 0 0 1-2.32 1.57" }),
    React.createElement("path", { d: "M21.16 12a3 3 0 0 1 2.32 1.57" }),
    React.createElement("path", { d: "M14.84 12a3 3 0 0 1-2.32-1.57" }),
    React.createElement("path", { d: "M14.84 18a3 3 0 0 1 2.32-1.57" })));
const PhoneOffIcon = (props) => (React.createElement("svg", { ...props, xmlns: "http://www.w3.org/2000/svg", width: "24", height: "24", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round" },
    React.createElement("path", { d: "M10.68 13.31a16 16 0 0 0 3.41 2.6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81 .7 2 2 0 0 1 1.72 2.05v1.59a2 2 0 0 1-2.18 2.18a19.79 19.79 0 0 1-8.63-3.07a19.42 19.42 0 0 1-3.33-2.67m-2.67-3.34a19.79 19.79 0 0 1-3.07-8.63A2 2 0 0 1 4.11 2h1.59a2 2 0 0 1 2.05 1.72a12.84 12.84 0 0 0 .7 2.81a2 2 0 0 1-.45 2.11L6.09 9.91" }),
    React.createElement("line", { x1: "23", y1: "1", x2: "1", y2: "23" })));
const SpinnerIcon = (props) => (React.createElement("svg", { ...props, xmlns: "http://www.w3.org/2000/svg", width: "24", height: "24", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round" },
    React.createElement("path", { d: "M21 12a9 9 0 1 1-6.219-8.56" })));
const BookmarkIcon = (props) => (React.createElement("svg", { ...props, xmlns: "http://www.w3.org/2000/svg", width: "24", height: "24", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round" },
    React.createElement("path", { d: "m19 21-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v16z" })));
const ClipboardListIcon = (props) => (React.createElement("svg", { ...props, xmlns: "http://www.w3.org/2000/svg", width: "24", height: "24", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round" },
    React.createElement("rect", { x: "8", y: "2", width: "8", height: "4", rx: "1", ry: "1" }),
    React.createElement("path", { d: "M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2" }),
    React.createElement("path", { d: "M12 11h4" }),
    React.createElement("path", { d: "M12 16h4" }),
    React.createElement("path", { d: "M8 11h.01" }),
    React.createElement("path", { d: "M8 16h.01" })));
const LockIcon = (props) => (React.createElement("svg", { ...props, xmlns: "http://www.w3.org/2000/svg", width: "24", height: "24", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round" },
    React.createElement("rect", { x: "3", y: "11", width: "18", height: "11", rx: "2", ry: "2" }),
    React.createElement("path", { d: "M7 11V7a5 5 0 0 1 10 0v4" })));
const StarIcon = (props) => (React.createElement("svg", { ...props, xmlns: "http://www.w3.org/2000/svg", width: "24", height: "24", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round" },
    React.createElement("polygon", { points: "12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2" })));
const GlowingStarIcon = (props) => (React.createElement("svg", { ...props, xmlns: "http://www.w3.org/2000/svg", width: "24", height: "24", viewBox: "0 0 24 24", fill: "currentColor", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round" },
    React.createElement("polygon", { points: "12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2" })));
const HelpCircleIcon = (props) => (React.createElement("svg", { ...props, xmlns: "http://www.w3.org/2000/svg", width: "24", height: "24", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round" },
    React.createElement("circle", { cx: "12", cy: "12", r: "10" }),
    React.createElement("path", { d: "M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3" }),
    React.createElement("line", { x1: "12", y1: "17", x2: "12.01", y2: "17" })));
const AlertTriangleIcon = (props) => (React.createElement("svg", { ...props, xmlns: "http://www.w3.org/2000/svg", width: "24", height: "24", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round" },
    React.createElement("path", { d: "m21.73 18-8-14a2 2 0 0 0-3.46 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z" }),
    React.createElement("line", { x1: "12", y1: "9", x2: "12", y2: "13" }),
    React.createElement("line", { x1: "12", y1: "17", x2: "12.01", y2: "17" })));
const PlaneIcon = (props) => (React.createElement("svg", { ...props, xmlns: "http://www.w3.org/2000/svg", width: "24", height: "24", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round" },
    React.createElement("path", { d: "M17.8 19.2 16 11l3.5-3.5C21 6 21.5 4 21 3c-1-.5-3 0-4.5 1.5L13 8 4.8 6.2c-.5-.1-.9.1-1.1.5l-.3.5c-.2.5-.1 1 .3 1.3L9 12l-2 3H4l-1 1 3 2 2 3 1-1v-3l3-2 3.5 5.3c.3.4.8.5 1.3.3l.5-.2c.4-.3.6-.7.5-1.2z" })));
const BriefcaseIcon = (props) => (React.createElement("svg", { ...props, xmlns: "http://www.w3.org/2000/svg", width: "24", height: "24", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round" },
    React.createElement("rect", { x: "2", y: "7", width: "20", height: "14", rx: "2", ry: "2" }),
    React.createElement("path", { d: "M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16" })));
const UsersIcon = (props) => (React.createElement("svg", { ...props, xmlns: "http://www.w3.org/2000/svg", width: "24", height: "24", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round" },
    React.createElement("path", { d: "M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2" }),
    React.createElement("circle", { cx: "8.5", cy: "7", r: "4" }),
    React.createElement("path", { d: "M20 8v6" }),
    React.createElement("path", { d: "M23 11h-6" })));
const ZapIcon = (props) => (React.createElement("svg", { ...props, xmlns: "http://www.w3.org/2000/svg", width: "24", height: "24", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round" },
    React.createElement("polygon", { points: "13 2 3 14 12 14 11 22 21 10 12 10 13 2" })));
const NovaIcon = (props) => (React.createElement("svg", { ...props, xmlns: "http://www.w3.org/2000/svg", width: "24", height: "24", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round" },
    React.createElement("path", { d: "M12 2 L14.5 9.5 L22 12 L14.5 14.5 L12 22 L9.5 14.5 L2 12 L9.5 9.5 Z" })));
const LyraIcon = (props) => (React.createElement("svg", { ...props, xmlns: "http://www.w3.org/2000/svg", width: "24", height: "24", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round" },
    React.createElement("path", { d: "M6 12c0-3.5 2-7 6-7s6 3.5 6 7-2 7-6 7-6-3.5-6-7Z" }),
    React.createElement("path", { d: "M10 12c0-1.5 1-3 3-3s3 1.5 3 3-1 3-3 3" })));
const RotateCcwIcon = (props) => (React.createElement("svg", { ...props, xmlns: "http://www.w3.org/2000/svg", width: "24", height: "24", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round" },
    React.createElement("path", { d: "M3 2v6h6" }),
    React.createElement("path", { d: "M3 13a9 9 0 1 0 3-7.7L3 8" })));
const LanguagesIcon = (props) => (React.createElement("svg", { ...props, xmlns: "http://www.w3.org/2000/svg", width: "24", height: "24", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round" },
    React.createElement("path", { d: "m5 8 6 6" }),
    React.createElement("path", { d: "m4 14 6-6 2-3" }),
    React.createElement("path", { d: "M2 5h12" }),
    React.createElement("path", { d: "M7 2h1" }),
    React.createElement("path", { d: "m22 22-5-10-5 10" }),
    React.createElement("path", { d: "M14 18h6" })));
const CogIcon = (props) => (React.createElement("svg", { ...props, xmlns: "http://www.w3.org/2000/svg", width: "24", height: "24", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round" },
    React.createElement("path", { d: "M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 0 2l-.15.08a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.38a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1 0-2l.15-.08a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z" }),
    React.createElement("circle", { cx: "12", cy: "12", r: "3" })));

// constants.ts
const SCENARIOS = [
    {
        id: 'airport',
        title: 'At the Airport',
        emoji: '‚úàÔ∏è',
        description: 'Navigate check-in, security, and boarding.',
        goal: 'Successfully check in for your flight and ask for a window seat.',
        reverseGoal: 'Act as airport staff and help a traveler check in for their flight.',
        systemPrompt: 'You are a helpful airport staff member. Guide the user, who is a traveler, through the process of checking in for a flight to London. Keep your responses friendly and concise.',
        reverseSystemPrompt: 'You are a traveler checking in for a flight. The user is the airport staff. Start by telling them you want to check in for your flight to London. Ask questions if you are unsure what to do.',
        backgroundImage: 'https://picsum.photos/seed/airport/1200/800',
    },
    {
        id: 'restaurant',
        title: 'In a Restaurant',
        emoji: 'üçî',
        description: 'Order food, ask for the bill, and interact with the waiter.',
        goal: 'Order a main course, a drink, and ask for the bill.',
        reverseGoal: 'Act as the waiter, take the customer\'s order, and bring them the bill.',
        systemPrompt: 'You are a friendly restaurant waiter. The user is a customer. Welcome them, take their order, and respond to their requests. Start by asking them if they are ready to order. Keep your language natural and appropriate for a casual dining setting.',
        reverseSystemPrompt: 'You are a customer at a restaurant. The user is the waiter. Wait for them to greet you and then order a meal. Start by telling them you are ready to order.',
        backgroundImage: 'https://picsum.photos/seed/restaurant/1200/800',
    },
    {
        id: 'job_interview',
        title: 'Job Interview',
        emoji: 'üíº',
        description: 'Answer common interview questions and showcase your skills.',
        goal: 'Introduce yourself and answer a question about your strengths.',
        reverseGoal: 'Act as the hiring manager and interview a candidate for a job.',
        systemPrompt: 'You are a hiring manager for a tech company. The user is a candidate for a software engineer role. Ask them common interview questions, starting with "Tell me about yourself." Evaluate their responses and provide a challenging but fair interview experience.',
        reverseSystemPrompt: 'You are a candidate interviewing for a software engineer role. The user is the hiring manager. Respond to their questions professionally. Start by introducing yourself when prompted.',
        backgroundImage: 'https://picsum.photos/seed/office/1200/800',
    },
    {
        id: 'hotel',
        title: 'At the Hotel',
        emoji: 'üè®',
        description: 'Check-in, ask for room service, and check-out.',
        goal: 'Check into the hotel and ask about the Wi-Fi password.',
        reverseGoal: 'Act as the hotel receptionist and check a guest in.',
        systemPrompt: 'You are a hotel receptionist. The user is a guest who wants to check in. Greet them warmly and guide them through the check-in process. Ask for their reservation name to begin.',
        reverseSystemPrompt: 'You are a guest checking into a hotel. The user is the receptionist. Start by saying you have a reservation and give them your name (e.g., "Smith").',
        backgroundImage: 'https://picsum.photos/seed/hotel/1200/800',
    },
    {
        id: 'friends',
        title: 'Meeting Friends',
        emoji: '‚òï',
        description: 'Make small talk and catch up with friends.',
        goal: 'Ask your friend how they have been and suggest an activity.',
        reverseGoal: 'Respond to your friend\'s questions and share what you\'ve been up to.',
        systemPrompt: 'You are a friend meeting the user at a cafe. You haven\'t seen them in a while. Start the conversation by saying "Hey! It\'s been a while, how have you been?". Be casual, friendly, and engaging.',
        reverseSystemPrompt: 'You are meeting a friend (the user) at a cafe. They will start the conversation. Respond to them in a friendly, casual, and engaging way.',
        backgroundImage: 'https://picsum.photos/seed/cafe/1200/800',
    },
    {
        id: 'doctor',
        title: 'At the Doctor',
        emoji: '‚öïÔ∏è',
        description: 'Describe your symptoms and understand the doctor\'s advice.',
        goal: 'Describe at least two symptoms to the doctor.',
        reverseGoal: 'Act as the doctor, listen to the patient\'s symptoms, and give advice.',
        systemPrompt: 'You are a caring doctor. The user is your patient. Begin by asking "Hello, what seems to be the problem today?". Listen to their symptoms patiently and ask clarifying questions.',
        reverseSystemPrompt: 'You are a patient visiting the doctor (the user). Wait for them to ask about your symptoms, then describe what is wrong (e.g., "I have a headache and a sore throat.").',
        backgroundImage: 'https://picsum.photos/seed/clinic/1200/800',
    },
];
const ACHIEVEMENTS = [
    {
        id: 'first_conversation',
        title: 'First Conversation',
        description: 'Complete your first conversation.',
        emoji: 'üëã',
        goal: 1,
    },
    {
        id: 'explorer',
        title: 'Explorer',
        description: 'Try 5 different scenarios.',
        emoji: 'üó∫Ô∏è',
        goal: 5,
    },
    {
        id: 'persistent',
        title: 'Persistent',
        description: 'Practice for 7 days in a row.',
        emoji: 'üî•',
        goal: 7,
    },
    {
        id: 'perfectionist',
        title: 'Perfectionist',
        description: 'Complete a conversation with no mistakes.',
        emoji: 'üéØ',
        goal: 1,
    },
];
const VOICES = [
    { id: 'Zephyr', name: 'Zephyr' },
    { id: 'Kore', name: 'Kore' },
    { id: 'Puck', name: 'Puck' },
    { id: 'Charon', name: 'Charon' },
    { id: 'Fenrir', name: 'Fenrir' },
];
const BOT_AVATARS = [
    {
        id: 'orion',
        name: 'Orion',
        icon: BotHeadIcon,
    },
    {
        id: 'nova',
        name: 'Nova',
        icon: NovaIcon,
    },
    {
        id: 'lyra',
        name: 'Lyra',
        icon: LyraIcon,
    },
];
const QUEST_DEFINITIONS = [
    { type: QuestType.COMPLETE_ANY_SCENARIO, description: 'Complete any scenario', goal: 1, xp: 20 },
    { type: QuestType.SAVE_VOCAB_WORDS, description: 'Save 3 new words', goal: 3, xp: 15 },
    { type: QuestType.SAVE_VOCAB_WORDS, description: 'Save your first new word', goal: 1, xp: 10 },
    { type: QuestType.CONVERSE_FOR_MINUTES, description: 'Practice for 2 minutes', goal: 120, xp: 25 },
    { type: QuestType.CONVERSE_FOR_MINUTES, description: 'Practice for 5 minutes', goal: 300, xp: 40 },
    ...SCENARIOS.map(s => ({
        type: QuestType.COMPLETE_SPECIFIC_SCENARIO,
        description: `Complete the "${s.title}" scenario`,
        goal: 1,
        xp: 30,
        meta: { scenarioId: s.id }
    })),
];
const SCENARIO_THEMES = {
  airport: {
    bgImage: 'https://images.unsplash.com/photo-1569154941061-e231b4725ef1?q=80&w=2070&auto=format&fit=crop',
    color: '#38bdf8', // sky-400
    sound: 'airport',
  },
  restaurant: {
    bgImage: 'https://images.unsplash.com/photo-1555396273-367ea4eb4db5?q=80&w=1974&auto=format&fit=crop',
    color: '#f87171', // red-400
    sound: 'restaurant',
  },
  job_interview: {
    bgImage: 'https://images.unsplash.com/photo-1521791136064-7986c2920216?q=80&w=2070&auto=format&fit=crop',
    color: '#818cf8', // indigo-400
    sound: 'interview',
  },
  hotel: {
    bgImage: 'https://images.unsplash.com/photo-1566073771259-6a8506099945?q=80&w=2070&auto=format&fit=crop',
    color: '#facc15', // yellow-400
    sound: 'hotel',
  },
  default: {
    bgImage: 'https://images.unsplash.com/photo-1531306728370-e2ebd9d7bb92?q=80&w=2070&auto=format&fit=crop',
    color: '#a78bfa', // violet-400
    sound: 'default',
  }
};

// services/audioService.ts
function decode(base64) {
    const binaryString = atob(base64);
    const len = binaryString.length;
    const bytes = new Uint8Array(len);
    for (let i = 0; i < len; i++) {
        bytes[i] = binaryString.charCodeAt(i);
    }
    return bytes;
}
function encode(bytes) {
    let binary = '';
    const len = bytes.byteLength;
    for (let i = 0; i < len; i++) {
        binary += String.fromCharCode(bytes[i]);
    }
    return btoa(binary);
}
function createBlob(data) {
    const l = data.length;
    const int16 = new Int16Array(l);
    for (let i = 0; i < l; i++) {
        int16[i] = data[i] * 32768.0;
    }
    return {
        data: encode(new Uint8Array(int16.buffer)),
        mimeType: 'audio/pcm;rate=16000',
    };
}
async function decodeAudioData(data, ctx, sampleRate, numChannels) {
    const dataInt16 = new Int16Array(data.buffer);
    const frameCount = dataInt16.length / numChannels;
    const buffer = ctx.createBuffer(numChannels, frameCount, sampleRate);
    for (let channel = 0; channel < numChannels; channel++) {
        const channelData = buffer.getChannelData(channel);
        for (let i = 0; i < frameCount; i++) {
            channelData[i] = dataInt16[i * numChannels + channel] / 32768.0;
        }
    }
    return buffer;
}
class AudioService {
    audioContext = null;
    isMuted = false;
    constructor() {
        if (typeof window !== 'undefined') {
            try {
                this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                this.isMuted = localStorage.getItem('soundMuted') === 'true';
            }
            catch (e) {
                console.error("Web Audio API is not supported in this browser.");
            }
        }
    }
    playTone(frequency, duration, type = 'sine', volume = 0.5) {
        if (!this.audioContext || this.isMuted)
            return;
        if (this.audioContext.state === 'suspended') {
            this.audioContext.resume();
        }
        const oscillator = this.audioContext.createOscillator();
        const gainNode = this.audioContext.createGain();
        oscillator.connect(gainNode);
        gainNode.connect(this.audioContext.destination);
        oscillator.type = type;
        oscillator.frequency.setValueAtTime(frequency, this.audioContext.currentTime);
        gainNode.gain.setValueAtTime(volume, this.audioContext.currentTime);
        gainNode.gain.exponentialRampToValueAtTime(0.0001, this.audioContext.currentTime + duration);
        oscillator.start(this.audioContext.currentTime);
        oscillator.stop(this.audioContext.currentTime + duration);
    }
    toggleMute() {
        this.isMuted = !this.isMuted;
        localStorage.setItem('soundMuted', this.isMuted.toString());
    }
    playWelcome() {
        if (!this.audioContext || this.isMuted)
            return;
        this.audioContext.currentTime;
        this.playTone(261.63, 0.15, 'triangle', 0.4);
        setTimeout(() => this.playTone(329.63, 0.15, 'triangle', 0.4), 100);
        setTimeout(() => this.playTone(392.00, 0.2, 'triangle', 0.4), 200);
    }
    playOnboardingWelcome() {
        if (!this.audioContext || this.isMuted)
            return;
        this.audioContext.currentTime;
        this.playTone(523.25, 0.2, 'sine', 0.3);
        setTimeout(() => this.playTone(783.99, 0.3, 'sine', 0.3), 150);
    }
    playTextAppear() {
        this.playTone(800, 0.05, 'triangle', 0.1);
    }
    playKeypress() {
        this.playTone(1200, 0.03, 'square', 0.05);
    }
    playButtonHover() {
        this.playTone(400, 0.08, 'sine', 0.15);
    }
    playSuccess() {
        if (!this.audioContext || this.isMuted)
            return;
        this.playTone(523.25, 0.2, 'sine', 0.5);
        setTimeout(() => this.playTone(659.25, 0.2, 'sine', 0.5), 120);
        setTimeout(() => this.playTone(783.99, 0.3, 'sine', 0.5), 240);
    }
    playError() {
        this.playTone(150, 0.3, 'square', 0.3);
    }
    playTransition() {
        if (!this.audioContext || this.isMuted)
            return;
        const oscillator = this.audioContext.createOscillator();
        const gainNode = this.audioContext.createGain();
        oscillator.connect(gainNode);
        gainNode.connect(this.audioContext.destination);
        oscillator.type = 'sine';
        gainNode.gain.setValueAtTime(0.3, this.audioContext.currentTime);
        oscillator.frequency.setValueAtTime(100, this.audioContext.currentTime);
        oscillator.frequency.exponentialRampToValueAtTime(800, this.audioContext.currentTime + 0.2);
        gainNode.gain.exponentialRampToValueAtTime(0.0001, this.audioContext.currentTime + 0.2);
        oscillator.start();
        oscillator.stop(this.audioContext.currentTime + 0.2);
    }
    playMessagePop() {
        this.playTone(600, 0.1, 'triangle', 0.3);
    }
    playMessageSend() {
        if (!this.audioContext || this.isMuted)
            return;
        const oscillator = this.audioContext.createOscillator();
        const gainNode = this.audioContext.createGain();
        oscillator.connect(gainNode);
        gainNode.connect(this.audioContext.destination);
        oscillator.type = 'sine';
        const now = this.audioContext.currentTime;
        gainNode.gain.setValueAtTime(0.4, now);
        gainNode.gain.exponentialRampToValueAtTime(0.0001, now + 0.15);
        oscillator.frequency.setValueAtTime(300, now);
        oscillator.frequency.exponentialRampToValueAtTime(1200, now + 0.15);
        oscillator.start(now);
        oscillator.stop(now + 0.15);
    }
    playCardFlip() {
        if (!this.audioContext || this.isMuted)
            return;
        const oscillator = this.audioContext.createOscillator();
        const gainNode = this.audioContext.createGain();
        oscillator.connect(gainNode);
        gainNode.connect(this.audioContext.destination);
        oscillator.type = 'sawtooth';
        const now = this.audioContext.currentTime;
        gainNode.gain.setValueAtTime(0.2, now);
        gainNode.gain.exponentialRampToValueAtTime(0.001, now + 0.1);
        oscillator.frequency.setValueAtTime(500, now);
        oscillator.frequency.exponentialRampToValueAtTime(150, now + 0.1);
        oscillator.start(now);
        oscillator.stop(now + 0.1);
    }
    playSummaryOpen() {
        if (!this.audioContext || this.isMuted)
            return;
        this.playTone(392.00, 0.1, 'sine', 0.4);
        setTimeout(() => this.playTone(523.25, 0.1, 'sine', 0.4), 100);
        setTimeout(() => this.playTone(659.25, 0.2, 'sine', 0.5), 200);
    }
    playAchievementUnlock() {
        if (!this.audioContext || this.isMuted)
            return;
        this.playTone(523.25, 0.1, 'sine', 0.6);
        setTimeout(() => this.playTone(659.25, 0.1, 'sine', 0.6), 100);
        setTimeout(() => this.playTone(783.99, 0.1, 'sine', 0.6), 200);
        setTimeout(() => this.playTone(1046.50, 0.2, 'sine', 0.6), 300);
    }
    playNoise(duration, volume, filterFreq, filterQ) {
        if (!this.audioContext || this.isMuted)
            return;
        const bufferSize = this.audioContext.sampleRate * duration;
        const buffer = this.audioContext.createBuffer(1, bufferSize, this.audioContext.sampleRate);
        const output = buffer.getChannelData(0);
        for (let i = 0; i < bufferSize; i++) {
            output[i] = Math.random() * 2 - 1;
        }
        const noise = this.audioContext.createBufferSource();
        noise.buffer = buffer;
        const filter = this.audioContext.createBiquadFilter();
        filter.type = 'lowpass';
        filter.frequency.setValueAtTime(filterFreq, this.audioContext.currentTime);
        filter.Q.setValueAtTime(filterQ, this.audioContext.currentTime);
        const gainNode = this.audioContext.createGain();
        gainNode.gain.setValueAtTime(volume, this.audioContext.currentTime);
        gainNode.gain.exponentialRampToValueAtTime(0.001, this.audioContext.currentTime + duration);
        noise.connect(filter);
        filter.connect(gainNode);
        gainNode.connect(this.audioContext.destination);
        noise.start();
        noise.stop(this.audioContext.currentTime + duration);
    }
    playAirportSound() { this.playNoise(0.8, 0.08, 600, 5); }
    playRestaurantSound() { this.playNoise(0.8, 0.05, 1000, 1); }
    playHotelSound() { this.playTone(440, 0.5, 'triangle', 0.1); }
    playInterviewSound() { this.playNoise(0.5, 0.03, 4000, 10); }
}
const audioService = new AudioService();

// services/userService.ts
const USER_PROFILE_KEY = 'talkmaster_user_profile';
class UserService {
    getUserProfile() {
        try {
            const profileJson = localStorage.getItem(USER_PROFILE_KEY);
            if (!profileJson)
                return null;
            const profile = JSON.parse(profileJson);
            if (!profile.avatarId) {
                profile.avatarId = 'orion';
            }
            return profile;
        }
        catch (error) {
            console.error('Error parsing user profile from localStorage:', error);
            localStorage.removeItem(USER_PROFILE_KEY);
            return null;
        }
    }
    saveUserProfile(profile) {
        try {
            const profileJson = JSON.stringify(profile);
            localStorage.setItem(USER_PROFILE_KEY, profileJson);
        }
        catch (error) {
            console.error('Error saving user profile to localStorage:', error);
        }
    }
}
const userService = new UserService();

// services/achievementService.ts
const STATS_KEY = 'talkmaster_stats';
const UNLOCKED_KEY = 'talkmaster_unlocked_achievements';
const isYesterday = (dateString) => {
    const today = new Date();
    const yesterday = new Date(today);
    yesterday.setDate(today.getDate() - 1);
    return yesterday.toISOString().split('T')[0] === dateString;
};
const isToday = (dateString) => {
    return new Date().toISOString().split('T')[0] === dateString;
};
class AchievementService {
    getStats() {
        try {
            const stats = localStorage.getItem(STATS_KEY);
            const parsedStats = stats ? JSON.parse(stats) : this.getDefaultStats();
            return {
                ...this.getDefaultStats(),
                ...parsedStats
            };
        }
        catch (error) {
            console.error('Error parsing user stats:', error);
            return this.getDefaultStats();
        }
    }
    saveStats(stats) {
        localStorage.setItem(STATS_KEY, JSON.stringify(stats));
    }
    checkAndResetStreak() {
        const stats = this.getStats();
        if (stats.lastConversationDate && !isToday(stats.lastConversationDate) && !isYesterday(stats.lastConversationDate)) {
            stats.streak = 0;
            this.saveStats(stats);
        }
    }
    getUnlockedAchievementIds() {
        try {
            const unlocked = localStorage.getItem(UNLOCKED_KEY);
            return unlocked ? new Set(JSON.parse(unlocked)) : new Set();
        }
        catch (error) {
            console.error('Error parsing unlocked achievements:', error);
            return new Set();
        }
    }
    saveUnlockedAchievementIds(unlockedIds) {
        localStorage.setItem(UNLOCKED_KEY, JSON.stringify(Array.from(unlockedIds)));
    }
    getDefaultStats() {
        return {
            conversationsCompleted: 0,
            uniqueScenarios: [],
            streak: 0,
            lastConversationDate: null,
            flawlessConversations: 0,
            dailyQuestsCompleted: 0,
        };
    }
    updateStatsAndCheckAchievements({ scenarioId, wasFlawless }) {
        const stats = this.getStats();
        const todayStr = new Date().toISOString().split('T')[0];
        stats.conversationsCompleted += 1;
        if (!stats.uniqueScenarios.includes(scenarioId)) {
            stats.uniqueScenarios.push(scenarioId);
        }
        if (wasFlawless) {
            stats.flawlessConversations += 1;
        }
        if (stats.lastConversationDate) {
            if (isYesterday(stats.lastConversationDate)) {
                stats.streak += 1;
            }
            else if (!isToday(stats.lastConversationDate)) {
                stats.streak = 1;
            }
        }
        else {
            stats.streak = 1;
        }
        stats.lastConversationDate = todayStr;
        this.saveStats(stats);
        const unlockedIds = this.getUnlockedAchievementIds();
        const achievementsToCheck = [
            { id: 'first_conversation', value: stats.conversationsCompleted },
            { id: 'explorer', value: stats.uniqueScenarios.length },
            { id: 'persistent', value: stats.streak },
            { id: 'perfectionist', value: stats.flawlessConversations },
        ];
        for (const check of achievementsToCheck) {
            if (!unlockedIds.has(check.id)) {
                const achievement = ACHIEVEMENTS.find(a => a.id === check.id);
                if (achievement && check.value >= achievement.goal) {
                    unlockedIds.add(achievement.id);
                    this.saveUnlockedAchievementIds(unlockedIds);
                    return achievement;
                }
            }
        }
        return null;
    }
    getAllAchievementsWithProgress() {
        const stats = this.getStats();
        const unlockedIds = this.getUnlockedAchievementIds();
        return ACHIEVEMENTS.map(ach => {
            let currentProgress = 0;
            switch (ach.id) {
                case 'first_conversation':
                    currentProgress = stats.conversationsCompleted;
                    break;
                case 'explorer':
                    currentProgress = stats.uniqueScenarios.length;
                    break;
                case 'persistent':
                    currentProgress = stats.streak;
                    break;
                case 'perfectionist':
                    currentProgress = stats.flawlessConversations;
                    break;
            }
            return {
                ...ach,
                isUnlocked: unlockedIds.has(ach.id),
                currentProgress: Math.min(currentProgress, ach.goal),
            };
        });
    }
}
const achievementService = new AchievementService();

// services/questService.ts
const QUESTS_KEY = 'talkmaster_daily_quests';
const QUESTS_DATE_KEY = 'talkmaster_quests_date';
class QuestService {
    getQuests() {
        const today = new Date().toISOString().split('T')[0];
        const lastGeneratedDate = localStorage.getItem(QUESTS_DATE_KEY);
        if (lastGeneratedDate !== today) {
            return this.generateDailyQuests();
        }
        try {
            const questsJson = localStorage.getItem(QUESTS_KEY);
            return questsJson ? JSON.parse(questsJson) : this.generateDailyQuests();
        }
        catch (error) {
            console.error('Error parsing quests:', error);
            return this.generateDailyQuests();
        }
    }
    saveQuests(quests) {
        localStorage.setItem(QUESTS_KEY, JSON.stringify(quests));
    }
    generateDailyQuests() {
        const today = new Date().toISOString().split('T')[0];
        const stats = achievementService.getStats();
        const availableQuests = QUEST_DEFINITIONS.filter(q => {
            if (q.type === QuestType.COMPLETE_SPECIFIC_SCENARIO && stats.conversationsCompleted < 1) {
                return false;
            }
            if (q.type === QuestType.CONVERSE_FOR_MINUTES && q.goal > 120 && stats.conversationsCompleted < 3) {
                return false;
            }
            return true;
        });
        const shuffled = [...availableQuests].sort(() => 0.5 - Math.random());
        const selectedQuests = shuffled.slice(0, 3).map((q, index) => ({
            ...q,
            id: `${today}-${index}`,
            currentProgress: 0,
            isCompleted: false,
            isClaimed: false,
        }));
        this.saveQuests(selectedQuests);
        localStorage.setItem(QUESTS_DATE_KEY, today);
        return selectedQuests;
    }
    updateQuestProgress(type, value) {
        const quests = this.getQuests();
        let questsUpdated = false;
        const updatedQuests = quests.map(quest => {
            if (quest.isCompleted) {
                return quest;
            }
            let progressMade = false;
            if (quest.type === type) {
                if (type === QuestType.COMPLETE_SPECIFIC_SCENARIO && quest.meta?.scenarioId === value) {
                    quest.currentProgress += 1;
                    progressMade = true;
                }
                else if (type === QuestType.COMPLETE_ANY_SCENARIO) {
                    quest.currentProgress += 1;
                    progressMade = true;
                }
                else if (type === QuestType.CONVERSE_FOR_MINUTES && typeof value === 'number') {
                    quest.currentProgress += value;
                    progressMade = true;
                }
                else if (type === QuestType.SAVE_VOCAB_WORDS) {
                    quest.currentProgress += 1;
                    progressMade = true;
                }
            }
            if (progressMade) {
                questsUpdated = true;
                if (quest.currentProgress >= quest.goal) {
                    quest.currentProgress = quest.goal;
                    quest.isCompleted = true;
                }
            }
            return quest;
        });
        if (questsUpdated) {
            this.saveQuests(updatedQuests);
        }
        return updatedQuests;
    }
    claimReward(questId) {
        const quests = this.getQuests();
        let xpGained = 0;
        const updatedQuests = quests.map(quest => {
            if (quest.id === questId && quest.isCompleted && !quest.isClaimed) {
                quest.isClaimed = true;
                xpGained = quest.xp;
            }
            return quest;
        });
        if (xpGained > 0) {
            this.saveQuests(updatedQuests);
        }
        return { quests, xpGained };
    }
}
const questService = new QuestService();

// services/reviewService.ts
const REVIEW_KEY = 'talkmaster_review_items';
class ReviewService {
    getReviewItems() {
        try {
            const items = localStorage.getItem(REVIEW_KEY);
            return items ? JSON.parse(items) : [];
        }
        catch (error) {
            console.error('Error parsing review items:', error);
            return [];
        }
    }
    addReviewItem(newItem) {
        const items = this.getReviewItems();
        if (!items.some(item => item.original.toLowerCase() === newItem.original.toLowerCase())) {
            const updatedItems = [newItem, ...items];
            localStorage.setItem(REVIEW_KEY, JSON.stringify(updatedItems));
        }
    }
    clearReviewItems() {
        localStorage.removeItem(REVIEW_KEY);
    }
}
const reviewService = new ReviewService();

// services/scenarioService.ts
const CUSTOM_SCENARIOS_KEY = 'talkmaster_custom_scenarios';
class ScenarioService {
    getCustomScenarios() {
        try {
            const scenariosJson = localStorage.getItem(CUSTOM_SCENARIOS_KEY);
            return scenariosJson ? JSON.parse(scenariosJson) : [];
        }
        catch (error) {
            console.error('Error parsing custom scenarios from localStorage:', error);
            return [];
        }
    }
    saveCustomScenario(newScenario) {
        const customScenarios = this.getCustomScenarios();
        const updatedScenarios = [newScenario, ...customScenarios];
        localStorage.setItem(CUSTOM_SCENARIOS_KEY, JSON.stringify(updatedScenarios));
    }
    getAllScenarios() {
        const customScenarios = this.getCustomScenarios();
        return [...customScenarios, ...SCENARIOS];
    }
    getNextScenarioInJourney() {
        const stats = achievementService.getStats();
        const completedScenarioIds = new Set(stats.uniqueScenarios);
        const nextScenario = SCENARIOS.find(s => !completedScenarioIds.has(s.id));
        return nextScenario || null;
    }
}
const scenarioService = new ScenarioService();

// services/vocabularyService.ts
const VOCABULARY_KEY = 'talkmaster_vocabulary_items';
class VocabularyService {
    getVocabularyItems() {
        try {
            const items = localStorage.getItem(VOCABULARY_KEY);
            return items ? JSON.parse(items) : [];
        }
        catch (error) {
            console.error('Error parsing vocabulary items:', error);
            return [];
        }
    }
    saveVocabularyItem(newItem) {
        const items = this.getVocabularyItems();
        if (!items.some(item => item.word.toLowerCase() === newItem.word.toLowerCase())) {
            const updatedItems = [newItem, ...items];
            localStorage.setItem(VOCABULARY_KEY, JSON.stringify(updatedItems));
        }
    }
    isWordSaved(word) {
        const items = this.getVocabularyItems();
        return items.some(item => item.word.toLowerCase() === word.toLowerCase());
    }
    clearVocabularyItems() {
        localStorage.removeItem(VOCABULARY_KEY);
    }
}
const vocabularyService = new VocabularyService();

// services/geminiService.ts
let ai = null;
const getAi = () => {
    if (!ai) {
        if (!process.env.API_KEY) {
            throw new Error("API_KEY environment variable not set");
        }
        ai = new GoogleGenAI({ apiKey: process.env.API_KEY });
    }
    return ai;
};
const connectLiveSession = (systemInstruction, userLevel, voice, callbacks) => {
    const fullSystemInstruction = `${systemInstruction} The user's English level is ${userLevel}. Adjust your vocabulary and speech speed accordingly.`;
    const aiInstance = getAi();
    return aiInstance.live.connect({
        model: 'gemini-2.5-flash-native-audio-preview-09-2025',
        callbacks,
        config: {
            systemInstruction: fullSystemInstruction,
            responseModalities: [Modality.AUDIO],
            speechConfig: {
                voiceConfig: { prebuiltVoiceConfig: { voiceName: voice.id } },
            },
            inputAudioTranscription: {},
            outputAudioTranscription: {},
        },
    });
};
const createChatSession = (systemInstruction, userLevel) => {
    const fullSystemInstruction = `${systemInstruction} The user's English level is ${userLevel}. Adjust your vocabulary and speech speed accordingly. Your responses should be text-based for a chat interface. Keep your responses concise.`;
    const aiInstance = getAi();
    return aiInstance.chats.create({
        model: 'gemini-2.5-flash',
        config: {
            systemInstruction: fullSystemInstruction,
        },
    });
};
const getFeedbackOnText = async (text) => {
    const aiInstance = getAi();
    const systemInstruction = `You are an expert English language teacher. Analyze the following text from a student. 
    Provide concise, helpful feedback to help them improve. 
    If there are errors, provide the correction and a very brief explanation. Your entire response should be one line.
    If there are no errors, simply say "Great job!".
    Example of a correction: "Correction: 'I go to the store yesterday.' -> 'I went to the store yesterday.' (Past tense)"
    Keep your feedback under 25 words.`;
    try {
        const response = await aiInstance.models.generateContent({
            model: 'gemini-2.5-flash',
            contents: text,
            config: {
                systemInstruction,
                maxOutputTokens: 50,
                thinkingConfig: { thinkingBudget: 25 },
            },
        });
        return response.text?.trim() || null;
    }
    catch (error) {
        console.error("Error getting feedback:", error);
        throw error;
    }
};
const generateSpeech = async (text, voiceName) => {
    const aiInstance = getAi();
    try {
        const response = await aiInstance.models.generateContent({
            model: "gemini-2.5-flash-preview-tts",
            contents: [{ parts: [{ text }] }],
            config: {
                responseModalities: [Modality.AUDIO],
                speechConfig: {
                    voiceConfig: {
                        prebuiltVoiceConfig: { voiceName },
                    },
                },
            },
        });
        return response.candidates?.[0]?.content?.parts?.[0]?.inlineData?.data ?? null;
    }
    catch (error) {
        console.error("Error generating speech:", error);
        return null;
    }
};
const getHint = async (messages, systemPrompt) => {
    const aiInstance = getAi();
    const hintSystemInstruction = `You are an expert English learning assistant. Your task is to suggest the user's next response in a conversation.
    The user is practicing English in a scenario where your role is: "${systemPrompt}".
    Based on the conversation history, provide a single, short, and logical sentence that the user could say next.
    Your response MUST ONLY be the suggested sentence. Do not add any extra text, quotation marks, or explanations like "You could say:".`;
    const conversationHistory = messages.map(m => `${m.speaker}: ${m.text}`).join('\n');
    const prompt = `Here is the conversation so far:\n${conversationHistory}\n\nWhat should the user say next?`;
    try {
        const response = await aiInstance.models.generateContent({
            model: 'gemini-2.5-flash',
            contents: prompt,
            config: {
                systemInstruction: hintSystemInstruction,
                maxOutputTokens: 50,
                temperature: 0.7,
                stopSequences: ["\n"],
            }
        });
        const hint = response.text?.trim().replace(/"/g, '');
        return hint || "Sorry, I can't think of a hint right now.";
    }
    catch (error) {
        console.error("Error getting hint:", error);
        throw error;
    }
};
const getWordInfo = async (word) => {
    const aiInstance = getAi();
    const prompt = `Provide a simple definition and a simple example sentence for the word "${word}".`;
    try {
        const response = await aiInstance.models.generateContent({
            model: 'gemini-2.5-flash',
            contents: prompt,
            config: {
                responseMimeType: 'application/json',
                responseSchema: {
                    type: Type.OBJECT,
                    properties: {
                        definition: { type: Type.STRING },
                        example: { type: Type.STRING },
                    },
                },
            },
        });
        if (response.text) {
            return JSON.parse(response.text);
        }
        return null;
    }
    catch (error) {
        console.error("Error getting word info:", error);
        throw error;
    }
};
const createCustomScenario = async (description) => {
    const aiInstance = getAi();
    const prompt = `Based on the user's request, create a complete scenario object for an English learning app. The user's request is: "${description}". Your response MUST be a valid JSON object with the following structure: { "title": string, "emoji": string (a single relevant emoji), "description": string (a short summary), "goal": string (a concise learning objective for the user), "systemPrompt": string (a detailed prompt for the AI bot to play its role, starting the conversation) }. Do not include any other text or explanations outside of the JSON object. Generate a creative and relevant scenario.`;
    try {
        const response = await aiInstance.models.generateContent({
            model: 'gemini-2.5-flash',
            contents: prompt,
            config: {
                responseMimeType: 'application/json',
                responseSchema: {
                    type: Type.OBJECT,
                    properties: {
                        title: { type: Type.STRING },
                        emoji: { type: Type.STRING },
                        description: { type: Type.STRING },
                        goal: { type: Type.STRING },
                        systemPrompt: { type: Type.STRING },
                    },
                    required: ["title", "emoji", "description", "goal", "systemPrompt"]
                },
            },
        });
        if (response.text) {
            return JSON.parse(response.text);
        }
        throw new Error("Failed to generate scenario from AI response.");
    }
    catch (error) {
        console.error("Error creating custom scenario:", error);
        throw error;
    }
};
const extractKeyVocabulary = async (messages) => {
    const aiInstance = getAi();
    const conversationText = messages.map(m => `${m.speaker}: ${m.text}`).join('\n');
    const prompt = `From the following conversation, identify up to 5 important vocabulary words an English learner should know. For each word, provide a simple definition and a simple example sentence.
    Conversation:
    ${conversationText}`;
    const systemInstruction = `You are an English teacher helping a student. Your response must be a valid JSON array of objects. Each object should have a "word" key, a "definition" key, and an "example" key. Do not include any other text or explanations.`;
    try {
        const response = await aiInstance.models.generateContent({
            model: 'gemini-2.5-flash',
            contents: prompt,
            config: {
                systemInstruction,
                responseMimeType: 'application/json',
                responseSchema: {
                    type: Type.ARRAY,
                    items: {
                        type: Type.OBJECT,
                        properties: {
                            word: { type: Type.STRING },
                            definition: { type: Type.STRING },
                            example: { type: Type.STRING },
                        },
                        required: ["word", "definition", "example"]
                    }
                },
            },
        });
        if (response.text) {
            const parsed = JSON.parse(response.text);
            return parsed.slice(0, 5);
        }
        return null;
    }
    catch (error) {
        console.error("Error extracting vocabulary:", error);
        return null;
    }
};
const getConversationTip = async (messages) => {
    const aiInstance = getAi();
    const conversationText = messages.map(m => `${m.speaker}: ${m.text}`).join('\n');
    const systemInstruction = `You are an expert English language coach. Analyze the provided conversation transcript.
    Based on the user's messages, identify a single, primary area for improvement.
    Provide one concise, positive, and actionable tip to help the user. The tip should be under 25 words.
    Start with a positive phrase like "Great job!" or "Nice work!".
    Example: "Great job! Try using more descriptive adjectives to make your stories more vivid."
    If the user made no mistakes, give a general encouragement tip.
    Your entire response must be just the tip itself.`;
    const prompt = `Conversation Transcript:\n${conversationText}\n\nProvide a helpful tip for the user:`;
    try {
        const response = await aiInstance.models.generateContent({
            model: 'gemini-2.5-flash',
            contents: prompt,
            config: {
                systemInstruction,
                maxOutputTokens: 60,
                temperature: 0.8,
            },
        });
        return response.text?.trim() || null;
    }
    catch (error) {
        console.error("Error getting conversation tip:", error);
        return null;
    }
};
const translateText = async (text) => {
    const aiInstance = getAi();
    const systemInstruction = `You are a helpful translation assistant. Translate the following English text to Arabic. Your response must only be the translated text, with no extra explanations or quotation marks.`;
    try {
        const response = await aiInstance.models.generateContent({
            model: 'gemini-2.5-flash',
            contents: text,
            config: {
                systemInstruction,
                maxOutputTokens: text.length * 2,
                temperature: 0.2,
            },
        });
        return response.text?.trim() || null;
    }
    catch (error) {
        console.error("Error translating text:", error);
        throw error;
    }
};
const translateVocabItem = async (definition, example) => {
    const aiInstance = getAi();
    const prompt = `Translate the following to Arabic.
    Definition to translate: "${definition}"
    Example sentence to translate: "${example}"`;
    try {
        const response = await aiInstance.models.generateContent({
            model: 'gemini-2.5-flash',
            contents: prompt,
            config: {
                responseMimeType: 'application/json',
                responseSchema: {
                    type: Type.OBJECT,
                    properties: {
                        translatedDefinition: { type: Type.STRING },
                        translatedExample: { type: Type.STRING },
                    },
                    required: ["translatedDefinition", "translatedExample"]
                },
            },
        });
        if (response.text) {
            return JSON.parse(response.text);
        }
        return null;
    }
    catch (error) {
        console.error("Error translating vocab item:", error);
        throw error;
    }
};

// hooks/useTypingEffect.ts
const useTypingEffect = (text, speed = 50, onComplete) => {
    const [displayedText, setDisplayedText] = useState('');
    const [isTyping, setIsTyping] = useState(false);
    useEffect(() => {
        if (!text)
            return;
        setIsTyping(true);
        setDisplayedText('');
        audioService.playTextAppear();
        let i = 0;
        const typingInterval = setInterval(() => {
            if (i < text.length) {
                setDisplayedText(prev => prev + text.charAt(i));
                i++;
            }
            else {
                clearInterval(typingInterval);
                setIsTyping(false);
                if (onComplete) {
                    onComplete();
                }
            }
        }, speed);
        return () => {
            clearInterval(typingInterval);
            setIsTyping(false);
        };
    }, [text, speed, onComplete]);
    return { displayedText, isTyping };
};

// components/AchievementToast.tsx
const AchievementToast = ({ achievement, onClose }) => {
    const [isExiting, setIsExiting] = useState(false);
    useEffect(() => {
        const exitTimer = setTimeout(() => {
            setIsExiting(true);
        }, 4500);
        const closeTimer = setTimeout(() => {
            onClose();
        }, 5000);
        return () => {
            clearTimeout(exitTimer);
            clearTimeout(closeTimer);
        };
    }, [achievement, onClose]);
    return (React.createElement("div", { className: `fixed bottom-5 right-5 z-50 w-full max-w-sm ${isExiting ? 'toast-exit' : 'toast-enter'}` },
        React.createElement("div", { className: "flex items-center p-4 text-slate-800 bg-white/70 dark:bg-slate-800/70 backdrop-blur-md border-l-4 border-amber-400 rounded-lg shadow-lg dark:text-slate-200" },
            React.createElement("div", { className: "flex-shrink-0 w-10 h-10 mr-3 text-3xl flex items-center justify-center" }, achievement.emoji),
            React.createElement("div", { className: "flex-grow" },
                React.createElement("p", { className: "font-bold text-amber-500" }, "Achievement Unlocked!"),
                React.createElement("p", { className: "text-sm font-medium" }, achievement.title)))));
};

// components/CustomScenarioModal.tsx
const RANDOM_IDEAS = [
    "I want to practice returning a faulty item to a store.",
    "Create a scenario where I have to make small talk at a party.",
    "I need to discuss a project deadline with my manager.",
    "Generate a scenario for asking for directions in a new city.",
    "Practice a first date conversation at a coffee shop."
];
const MAX_CHARS = 300;
const CustomScenarioModal = ({ onClose, onScenarioCreated }) => {
    const [description, setDescription] = useState('');
    const [isGenerating, setIsGenerating] = useState(false);
    const [error, setError] = useState(null);
    const [previewScenario, setPreviewScenario] = useState(null);
    const [loadingText, setLoadingText] = useState('Thinking of your adventure‚Ä¶');
    const handleGenerate = async (e) => {
        e.preventDefault();
        if (!description.trim() || isGenerating)
            return;
        setIsGenerating(true);
        setError(null);
        setPreviewScenario(null);
        const emojis = ['‚úàÔ∏è', '‚òï', 'üè®', 'üíº', 'ü§ù'];
        let emojiIndex = 0;
        const interval = setInterval(() => {
            setLoadingText(`Thinking of your adventure‚Ä¶ ${emojis[emojiIndex]}`);
            emojiIndex = (emojiIndex + 1) % emojis.length;
        }, 800);
        try {
            const generatedContent = await createCustomScenario(description);
            audioService.playAchievementUnlock();
            setPreviewScenario(generatedContent);
        }
        catch (err) {
            console.error(err);
            setError('Failed to generate scenario. The AI might be busy. Please try again in a moment.');
            audioService.playError();
        }
        finally {
            setIsGenerating(false);
            clearInterval(interval);
        }
    };
    const handleSaveScenario = () => {
        if (!previewScenario)
            return;
        const newScenario = {
            ...previewScenario,
            id: `custom-${Date.now()}`,
            backgroundImage: `https://picsum.photos/seed/${Date.now()}/1200/800`,
            isCustom: true,
            reverseGoal: `Practice the opposite role in the "${previewScenario.title}" scenario.`,
            reverseSystemPrompt: `You are playing the opposite role in the "${previewScenario.title}" scenario. The user is practicing their English. Respond to them naturally to continue the conversation.`,
        };
        scenarioService.saveCustomScenario(newScenario);
        onScenarioCreated();
    };
    const handleTryAgain = () => {
        setPreviewScenario(null);
        setDescription('');
        setError(null);
    };
    const handleRandomIdea = () => {
        const randomIdea = RANDOM_IDEAS[Math.floor(Math.random() * RANDOM_IDEAS.length)];
        setDescription(randomIdea);
    };
    const renderContent = () => {
        if (isGenerating) {
            return (React.createElement("div", { className: "flex flex-col items-center justify-center min-h-[350px] text-center animate-fadeIn" },
                React.createElement(SpinnerIcon, { className: "w-16 h-16 text-white animate-spin" }),
                React.createElement("p", { className: "mt-4 text-xl font-semibold" }, loadingText)));
        }
        if (previewScenario) {
            return (React.createElement("div", { className: "flex flex-col items-center text-center animate-fadeIn" },
                React.createElement(CheckCircleIcon, { className: "w-12 h-12 text-emerald-400" }),
                React.createElement("h2", { className: "mt-2 text-2xl font-bold" }, "Here's Your Scenario!"),
                React.createElement("div", { className: "w-full p-4 mt-4 text-left bg-white/5 rounded-xl border border-white/20" },
                    React.createElement("p", { className: "text-2xl font-bold" },
                        previewScenario.emoji,
                        " ",
                        previewScenario.title),
                    React.createElement("p", { className: "mt-2 text-sm text-slate-300" }, previewScenario.description),
                    React.createElement("p", { className: "mt-4 text-xs font-semibold text-amber-300" }, "Your Goal:"),
                    React.createElement("p", { className: "text-sm" }, previewScenario.goal)),
                React.createElement("div", { className: "flex justify-between w-full mt-6" },
                    React.createElement("button", { type: "button", onClick: handleTryAgain, className: "px-6 py-2 font-bold bg-transparent rounded-full hover:bg-white/10 transition-colors" }, "Try Again"),
                    React.createElement("button", { type: "button", onClick: handleSaveScenario, className: "px-6 py-2 font-bold text-white transition-all duration-300 transform rounded-full bg-gradient-to-r from-emerald-500 to-sky-500 hover:scale-105 hover:shadow-lg hover:shadow-cyan-500/30" }, "Save & Continue"))));
        }
        return (React.createElement(React.Fragment, null,
            React.createElement("div", { className: "flex flex-col items-center text-center" },
                React.createElement("span", { className: "text-3xl", role: "img", "aria-label": "sparkles" }, "\u2728"),
                React.createElement("h2", { className: "mt-2 text-2xl font-bold" }, "Let\u2019s create your next conversation adventure!"),
                React.createElement("div", { className: "relative w-24 h-24 mt-4" },
                    React.createElement("div", { className: "absolute inset-0 rounded-full bg-purple-400/50 blur-xl", style: { animation: 'avatar-pulse 3s infinite ease-in-out' } }),
                    React.createElement("div", { className: "relative flex items-center justify-center w-full h-full p-2 border-2 rounded-full bg-slate-800/50 border-slate-500/50" },
                        React.createElement(BotHeadIcon, { className: "w-12 h-12 text-slate-200" })))),
            React.createElement("form", { onSubmit: handleGenerate, className: "mt-6 space-y-4" },
                React.createElement("div", { className: "relative" },
                    React.createElement("textarea", { value: description, onChange: (e) => setDescription(e.target.value), placeholder: "Describe your dream English scenario\u2026", maxLength: MAX_CHARS, className: "w-full h-32 p-4 text-white bg-white/5 backdrop-blur-md rounded-2xl border border-white/10 focus:outline-none focus:ring-2 focus:ring-purple-400 placeholder:text-slate-400 transition-all duration-300 shadow-lg resize-none", required: true }),
                    React.createElement("div", { className: "absolute bottom-3 right-3 flex items-center space-x-2" },
                        React.createElement("button", { type: "button", onClick: handleRandomIdea, className: "px-3 py-1 text-xs font-semibold text-white bg-white/10 rounded-full hover:bg-white/20 transition-colors backdrop-blur-sm" }, "\uD83C\uDFB2 Random Idea"),
                        React.createElement("span", { className: "text-xs text-slate-400" },
                            description.length,
                            " / ",
                            MAX_CHARS))),
                error && React.createElement("p", { className: "text-sm text-center text-rose-400" }, error),
                React.createElement("div", { className: "flex justify-between items-center pt-4" },
                    React.createElement("button", { type: "button", onClick: onClose, className: "px-8 py-3 font-bold bg-transparent rounded-full hover:bg-white/10 transition-colors" }, "Cancel"),
                    React.createElement("button", { type: "submit", disabled: !description.trim(), className: "px-8 py-3 font-bold text-white transition-all duration-300 transform rounded-full bg-gradient-to-r from-emerald-500 to-sky-500 hover:scale-105 hover:shadow-lg hover:shadow-cyan-500/30 disabled:from-slate-500 disabled:to-slate-600 disabled:hover:scale-100 disabled:shadow-none disabled:cursor-not-allowed active:scale-100" }, "Generate Scenario")))));
    };
    return (React.createElement("div", { className: "modal-overlay fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm", onClick: onClose },
        React.createElement("div", { className: "modal-content relative w-full max-w-lg p-6 mx-4 bg-gradient-to-br from-slate-900 via-purple-900/80 to-blue-900 border border-white/20 rounded-3xl shadow-2xl text-white", onClick: e => e.stopPropagation() }, renderContent())));
};

// components/LearningJourney.tsx
const LearningJourney = ({ scenarios, onScenarioSelect, onScenarioCreated, nextScenarioId }) => {
    const [isModalOpen, setIsModalOpen] = useState(false);
    const completedScenarioIds = new Set(achievementService.getStats().uniqueScenarios);
    const journeyScenarios = SCENARIOS;
    const customScenarios = scenarios.filter(s => s.isCustom);
    const getStatus = (scenarioId) => {
        if (completedScenarioIds.has(scenarioId))
            return 'completed';
        if (scenarioId === nextScenarioId)
            return 'next';
        if (completedScenarioIds.size === 0 && journeyScenarios[0]?.id === scenarioId) {
            return 'next';
        }
        const scenarioIndex = journeyScenarios.findIndex(s => s.id === scenarioId);
        const nextScenarioIndex = journeyScenarios.findIndex(s => s.id === nextScenarioId);
        if (nextScenarioId === null && completedScenarioIds.size === journeyScenarios.length)
            return 'completed';
        if (nextScenarioId === null && completedScenarioIds.size === 0)
            return 'locked';
        if (scenarioIndex > nextScenarioIndex)
            return 'locked';
        return 'locked';
    };
    const handleScenarioClick = (e, scenario, isLocked) => {
        e.stopPropagation();
        if (!isLocked) {
            onScenarioSelect(scenario);
        }
    };
    return (React.createElement("div", { className: "p-6 bg-slate-100/40 dark:bg-slate-900/40 backdrop-blur-sm border border-white/30 dark:border-white/10 rounded-2xl neumorph-shadow-light dark:neumorph-shadow-dark" },
        React.createElement("h2", { className: "text-2xl font-bold" }, "Your Learning Journey"),
        React.createElement("p", { className: "mt-1 text-slate-500 dark:text-slate-400" }, "Follow the path to master new conversations."),
        React.createElement("div", { className: "relative mt-8 journey-line" },
            React.createElement("div", { className: "relative flex justify-between" }, journeyScenarios.map((scenario) => {
                const status = getStatus(scenario.id);
                const isLocked = status === 'locked';
                const isNext = status === 'next';
                const isCompleted = status === 'completed';
                return (React.createElement("div", { key: scenario.id, onClick: (e) => handleScenarioClick(e, scenario, isLocked), className: `relative flex flex-col items-center group ${isLocked ? 'cursor-not-allowed' : 'cursor-pointer'}` },
                    React.createElement("div", { className: `w-16 h-16 rounded-full flex items-center justify-center transition-all duration-300 z-10
                        ${isCompleted ? 'bg-gradient-to-br from-amber-400 to-yellow-500' : ''}
                        ${isNext ? 'bg-gradient-to-r from-teal-400 to-purple-500 pulse-glow' : ''}
                        ${isLocked ? 'bg-slate-300 dark:bg-slate-600' : 'bg-white dark:bg-slate-800'}
                        border-4 
                        ${isCompleted ? 'border-amber-200 dark:border-amber-700' : isNext ? 'border-purple-300 dark:border-purple-700' : 'border-slate-200 dark:border-slate-700'}
                        ${!isLocked ? 'group-hover:scale-110' : ''}` },
                        isCompleted && React.createElement(StarIcon, { className: "w-8 h-8 text-white" }),
                        isNext && React.createElement("span", { className: "text-3xl" }, scenario.emoji),
                        isLocked && React.createElement(LockIcon, { className: "w-8 h-8 text-slate-500 dark:text-slate-400" })),
                    React.createElement("p", { className: `mt-3 text-sm font-semibold text-center w-24
                        ${isNext ? 'text-transparent bg-clip-text bg-gradient-to-r from-teal-500 to-purple-500' : 'text-slate-600 dark:text-slate-400'}` }, scenario.title),
                    React.createElement("div", { className: "absolute bottom-full mb-3 w-48 p-2 text-xs text-white bg-slate-900/80 backdrop-blur-sm rounded-md text-center opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none z-20" },
                        scenario.description,
                        isLocked && React.createElement("span", { className: "block mt-1 font-bold text-amber-300" }, "Complete previous step to unlock!"))));
            }))),
        (customScenarios.length > 0 || onScenarioCreated) && (React.createElement("div", { className: "mt-8 pt-6 border-t border-slate-200 dark:border-slate-700" },
            React.createElement("h3", { className: "text-lg font-bold" }, "Your Custom Scenarios"),
            React.createElement("div", { className: "grid grid-cols-1 gap-4 mt-4 sm:grid-cols-2 lg:grid-cols-3" },
                customScenarios.map((scenario) => (React.createElement("div", { key: scenario.id, onClick: (e) => handleScenarioClick(e, scenario, false), className: "group flex items-center p-4 space-x-3 bg-slate-100/70 rounded-lg cursor-pointer dark:bg-slate-800/50 transition-all duration-200 hover:shadow-lg hover:scale-105 hover:bg-teal-100/50 dark:hover:bg-teal-900/50 border border-transparent hover:border-teal-300 dark:hover:border-teal-600" },
                    React.createElement("span", { className: "text-2xl" }, scenario.emoji),
                    React.createElement("div", null,
                        React.createElement("p", { className: "font-semibold" }, scenario.title),
                        React.createElement("p", { className: "text-xs text-slate-500 dark:text-slate-400" }, scenario.description))))),
                React.createElement("div", { onClick: (e) => { e.stopPropagation(); setIsModalOpen(true); }, className: "group relative flex flex-col justify-center items-center p-4 text-center text-slate-500 transition-all duration-300 bg-gradient-to-br from-slate-200 to-slate-100 border-2 border-dashed rounded-lg shadow-sm cursor-pointer dark:from-slate-800/80 dark:to-slate-800/50 hover:border-purple-500 hover:text-purple-500 dark:border-slate-700 dark:text-slate-400 dark:hover:border-purple-400 dark:hover:text-purple-400 pulse-glow-button" },
                    React.createElement(PlusIcon, { className: "w-8 h-8 transition-transform duration-300 group-hover:scale-110" }),
                    React.createElement("h3", { className: "mt-2 text-sm font-bold" }, "Create New"))))),
        isModalOpen && (React.createElement(CustomScenarioModal, { onClose: () => setIsModalOpen(false), onScenarioCreated: () => {
                onScenarioCreated();
                setIsModalOpen(false);
            } }))));
};

// components/DailyQuests.tsx
const DailyQuests = ({ onClaimReward }) => {
    const [quests, setQuests] = useState([]);
    const [isExpanded, setIsExpanded] = useState(true);
    useEffect(() => {
        setQuests(questService.getQuests());
    }, []);
    const handleClaim = (questId) => {
        onClaimReward(questId);
        setQuests(prevQuests => prevQuests.map(q => q.id === questId ? { ...q, isClaimed: true } : q));
    };
    const allClaimed = quests.every(q => q.isClaimed);
    return (React.createElement("div", { className: "p-6 bg-gradient-to-br from-teal-100/50 to-purple-100/50 dark:from-teal-900/30 dark:to-purple-900/30 rounded-2xl neumorph-shadow-light dark:neumorph-shadow-dark" },
        React.createElement("div", { className: "flex items-center justify-between cursor-pointer", onClick: () => setIsExpanded(!isExpanded) },
            React.createElement("div", { className: "flex items-center space-x-3" },
                React.createElement(ClipboardListIcon, { className: "w-8 h-8 text-teal-500" }),
                React.createElement("h2", { className: "text-xl font-bold" }, "Daily Quests")),
            React.createElement("div", { className: "flex items-center space-x-2" },
                allClaimed && (React.createElement("span", { className: "px-3 py-1 text-xs font-bold text-emerald-700 bg-emerald-100 rounded-full dark:bg-emerald-900/50 dark:text-emerald-300" }, "All Done!")),
                React.createElement("svg", { className: `w-5 h-5 transition-transform duration-300 ${isExpanded ? 'rotate-180' : ''}`, fill: "none", viewBox: "0 0 24 24", stroke: "currentColor" },
                    React.createElement("path", { strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: 2, d: "M19 9l-7 7-7-7" })))),
        isExpanded && (React.createElement("div", { className: "mt-4 space-y-4" }, quests.length > 0 ? quests.map(quest => (React.createElement("div", { key: quest.id, className: "flex items-center justify-between p-3 bg-white/40 dark:bg-slate-800/40 rounded-lg" },
            React.createElement("div", { className: "flex-grow" },
                React.createElement("p", { className: "font-semibold text-slate-800 dark:text-slate-200" }, quest.description),
                React.createElement("div", { className: "flex items-center mt-1 space-x-2" },
                    React.createElement("div", { className: "w-full bg-slate-200/70 rounded-full h-2.5 dark:bg-slate-700/70 shadow-inner" },
                        React.createElement("div", { className: "bg-gradient-to-r from-teal-400 to-purple-500 h-2.5 rounded-full transition-all duration-500", style: { width: `${(quest.currentProgress / quest.goal) * 100}%` } })),
                    React.createElement("span", { className: "text-xs font-medium text-slate-500" },
                        Math.min(quest.currentProgress, quest.goal),
                        "/",
                        quest.goal))),
            React.createElement("div", { className: "ml-4" },
                React.createElement("button", { onClick: () => handleClaim(quest.id), disabled: !quest.isCompleted || quest.isClaimed, className: `px-4 py-2 text-sm font-bold rounded-full transition-all duration-200 w-32 text-center flex items-center justify-center
                                ${quest.isClaimed ? 'bg-slate-200 text-slate-500 dark:bg-slate-700 dark:text-slate-400 cursor-default' : ''}
                                ${quest.isCompleted && !quest.isClaimed ? 'bg-gradient-to-r from-amber-400 to-yellow-500 text-white shadow-lg hover:scale-105 pulse-glow-button' : ''}
                                ${!quest.isCompleted ? 'bg-slate-100 text-slate-600 dark:bg-slate-900/50 dark:text-slate-300 cursor-default' : ''}` }, quest.isClaimed ? (React.createElement(React.Fragment, null,
                    React.createElement(CheckIcon, { className: "w-4 h-4 mr-1" }),
                    " Claimed")) : quest.isCompleted ? React.createElement(React.Fragment, null,
                    React.createElement(SparklesIcon, { className: "w-4 h-4 mr-1" }), `Claim +${quest.xp} XP`) : `+${quest.xp} XP`))))) : React.createElement("p", { className: "text-sm text-center text-slate-500" }, "Could not load quests. Try again tomorrow!")))));
};

// components/Dashboard.tsx
const StatCard = ({ icon, value, label, iconBg }) => (React.createElement("div", { className: "flex items-center p-4 space-x-4 bg-slate-100/40 dark:bg-slate-900/40 backdrop-blur-sm border border-white/30 dark:border-white/10 rounded-2xl neumorph-shadow-light dark:neumorph-shadow-dark transition-all duration-300 hover:scale-105 hover:-translate-y-1" },
    React.createElement("div", { className: `p-3 rounded-xl shadow-lg ${iconBg}` }, icon),
    React.createElement("div", null,
        React.createElement("p", { className: "text-2xl font-bold text-slate-800 dark:text-slate-100" }, value),
        React.createElement("p", { className: "text-sm font-semibold text-slate-500 dark:text-slate-400" }, label))));
const getWelcomeMessage = (userName) => {
    const stats = achievementService.getStats();
    if (stats.conversationsCompleted === 0) {
        return {
            title: `Welcome, ${userName}!`,
            subtitle: "Your journey to fluency starts now. Let's begin!"
        };
    }
    if (stats.streak > 1) {
        return {
            title: `You're on a ${stats.streak}-day streak!`,
            subtitle: `Incredible work, ${userName}. Keep that momentum blazing.`
        };
    }
    const lastScenarioId = stats.uniqueScenarios[stats.uniqueScenarios.length - 1];
    if (lastScenarioId) {
        const lastScenario = scenarioService.getAllScenarios().find(s => s.id === lastScenarioId);
        if (lastScenario) {
            return {
                title: `Welcome back, ${userName}!`,
                subtitle: `Great job with the "${lastScenario.title}" scenario. Ready for the next challenge?`
            };
        }
    }
    return {
        title: `Welcome back, ${userName}!`,
        subtitle: "Another day, another step towards mastering English."
    };
};
const Dashboard = ({ onScenarioSelect, scenarios, userName, selectedAvatarId, onSelectAvatar, onClaimQuestReward, onScenarioCreated }) => {
    const [stats, setStats] = useState(achievementService.getStats());
    const [quests, setQuests] = useState(questService.getQuests());
    const [nextScenario, setNextScenario] = useState(null);
    useEffect(() => {
        setStats(achievementService.getStats());
        setNextScenario(scenarioService.getNextScenarioInJourney());
        setQuests(questService.getQuests());
    }, [scenarios]);
    const { title, subtitle } = getWelcomeMessage(userName);
    return (React.createElement("div", { className: "space-y-8" },
        React.createElement("div", { className: "animate-fadeIn" },
            React.createElement("h1", { className: "text-4xl font-bold text-slate-900 dark:text-white" }, title),
            React.createElement("p", { className: "mt-2 text-lg text-slate-600 dark:text-slate-300" }, subtitle)),
        React.createElement("div", { className: "grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-4" },
            React.createElement("div", { className: "animate-fadeIn animate-fadeIn-delay" },
                React.createElement(StatCard, { icon: React.createElement(FlameIcon, { className: "w-6 h-6 text-white" }), value: `${stats.streak} Days`, label: "Current Streak", iconBg: "bg-gradient-to-br from-rose-400 to-rose-600" })),
            React.createElement("div", { className: "animate-fadeIn animate-fadeIn-delay-2" },
                React.createElement(StatCard, { icon: React.createElement(SparklesIcon, { className: "w-6 h-6 text-white" }), value: stats.conversationsCompleted, label: "Sessions Done", iconBg: "bg-gradient-to-br from-emerald-400 to-emerald-600" })),
            React.createElement("div", { className: "animate-fadeIn animate-fadeIn-delay-3" },
                React.createElement(StatCard, { icon: React.createElement(TrophyIcon, { className: "w-6 h-6 text-white" }), value: achievementService.getUnlockedAchievementIds().size, label: "Achievements", iconBg: "bg-gradient-to-br from-amber-400 to-amber-600" })),
            React.createElement("div", { className: "animate-fadeIn animate-fadeIn-delay-3" },
                React.createElement(StatCard, { icon: React.createElement(ClipboardListIcon, { className: "w-6 h-6 text-white" }), value: `${quests.filter(q => q.isClaimed).length}/${quests.length}`, label: "Quests Done", iconBg: "bg-gradient-to-br from-teal-400 to-teal-600" }))),
        React.createElement("div", { className: "p-6 bg-slate-100/40 dark:bg-slate-900/40 backdrop-blur-sm border border-white/30 dark:border-white/10 rounded-2xl neumorph-shadow-light dark:neumorph-shadow-dark animate-fadeIn animate-fadeIn-delay-2" },
            React.createElement("h2", { className: "text-xl font-bold" }, "AI Avatar"),
            React.createElement("p", { className: "mt-1 text-slate-500 dark:text-slate-400" }, "Choose your conversation partner."),
            React.createElement("div", { className: "grid grid-cols-3 gap-4 mt-4" }, BOT_AVATARS.map((avatar) => {
                const Icon = avatar.icon;
                const isSelected = selectedAvatarId === avatar.id;
                return (React.createElement("div", { key: avatar.id, onClick: () => onSelectAvatar(avatar.id), className: `relative p-4 text-center rounded-2xl cursor-pointer transition-all duration-300
                                    ${isSelected ? 'bg-white/50 dark:bg-slate-800/50 scale-105' : 'bg-slate-200/50 dark:bg-slate-800/30 hover:bg-slate-200/80 dark:hover:bg-slate-800/60'}` },
                    React.createElement("div", { className: `relative flex items-center justify-center w-20 h-20 mx-auto bg-slate-100 dark:bg-slate-700 rounded-full transition-all duration-300 ring-4 ${isSelected ? 'ring-purple-500' : 'ring-transparent'}` },
                        React.createElement(Icon, { className: "w-11 h-11 text-slate-800 dark:text-slate-200" }),
                        isSelected && (React.createElement("div", { className: "absolute -top-1 -right-1 flex items-center justify-center w-7 h-7 text-white bg-gradient-to-br from-teal-400 to-purple-500 rounded-full shadow-lg" },
                            React.createElement(CheckIcon, { className: "w-4 h-4" })))),
                    React.createElement("p", { className: "mt-3 font-semibold text-slate-800 dark:text-slate-200" }, avatar.name)));
            }))),
        React.createElement("div", { className: "animate-fadeIn animate-fadeIn-delay-3" },
            React.createElement(DailyQuests, { onClaimReward: onClaimQuestReward })),
        React.createElement("div", { className: "animate-fadeIn animate-fadeIn-delay-3" },
            React.createElement(LearningJourney, { scenarios: scenarios, onScenarioSelect: onScenarioSelect, onScenarioCreated: onScenarioCreated, nextScenarioId: nextScenario?.id }))));
};

// components/Header.tsx
const Header = ({ userLevel, xp, theme, toggleTheme, isSoundEnabled, toggleSound, onShowLearnAndReview, onShowSettings }) => {
    const xpForNextLevel = userLevel * 100;
    const currentLevelXp = xp - ((userLevel - 1) * 100);
    const progressPercentage = (currentLevelXp / 100) * 100;
    return (React.createElement("header", { className: "sticky top-4 z-50 flex items-center justify-between p-4 bg-slate-100/40 dark:bg-slate-900/40 backdrop-blur-lg border border-white/30 dark:border-white/10 rounded-2xl neumorph-shadow-light dark:neumorph-shadow-dark" },
        React.createElement("div", { className: "flex items-center p-2 -m-2 space-x-3", "aria-label": "User level" },
            React.createElement(TrophyIcon, { className: "w-10 h-10 text-amber-400 drop-shadow-lg" }),
            React.createElement("div", null,
                React.createElement("h1", { className: "text-xl font-bold text-left text-transparent bg-clip-text bg-gradient-to-r from-teal-400 to-purple-500" }, "TalkMaster"),
                React.createElement("p", { className: "text-sm font-semibold text-left text-slate-500 dark:text-slate-400" },
                    "Level ",
                    userLevel))),
        React.createElement("div", { className: "flex items-center space-x-4 w-1/3" },
            React.createElement("div", { className: "w-full bg-slate-200/70 dark:bg-slate-700/70 rounded-full h-3.5 shadow-inner" },
                React.createElement("div", { className: "bg-gradient-to-r from-teal-400 to-purple-500 h-3.5 rounded-full transition-all duration-1000 ease-out", style: { width: `${progressPercentage}%`, boxShadow: '0 0 10px #4dd0e1, 0 0 5px #a78bfa' } })),
            React.createElement("span", { className: "text-sm font-medium text-slate-600 dark:text-slate-300" },
                currentLevelXp,
                " / 100 XP")),
        React.createElement("div", { className: "flex items-center space-x-2" },
            React.createElement("button", { onClick: onShowLearnAndReview, className: "p-3 text-slate-600 bg-slate-100 rounded-full dark:bg-slate-800 dark:text-slate-300 focus:outline-none transition-all duration-200 active:scale-95 neumorph-shadow-light dark:neumorph-shadow-dark hover:bg-slate-200 dark:hover:bg-slate-700", "aria-label": "Learn and Review" },
                React.createElement(BookOpenIcon, { className: "w-5 h-5" })),
            React.createElement("button", { onClick: onShowSettings, className: "p-3 text-slate-600 bg-slate-100 rounded-full dark:bg-slate-800 dark:text-slate-300 focus:outline-none transition-all duration-200 active:scale-95 neumorph-shadow-light dark:neumorph-shadow-dark hover:bg-slate-200 dark:hover:bg-slate-700", "aria-label": "Settings" },
                React.createElement(CogIcon, { className: "w-5 h-5" })),
            React.createElement("button", { onClick: toggleSound, className: "p-3 text-slate-600 bg-slate-100 rounded-full dark:bg-slate-800 dark:text-slate-300 focus:outline-none transition-all duration-200 active:scale-95 neumorph-shadow-light dark:neumorph-shadow-dark hover:bg-slate-200 dark:hover:bg-slate-700", "aria-label": "Toggle sound" }, isSoundEnabled ? React.createElement(VolumeUpIcon, { className: "w-5 h-5" }) : React.createElement(VolumeOffIcon, { className: "w-5 h-5" })),
            React.createElement("button", { onClick: toggleTheme, className: "p-3 text-slate-600 bg-slate-100 rounded-full dark:bg-slate-800 dark:text-slate-300 focus:outline-none transition-all duration-200 active:scale-95 neumorph-shadow-light dark:neumorph-shadow-dark hover:bg-slate-200 dark:hover:bg-slate-700", "aria-label": "Toggle theme" }, theme === 'light' ? React.createElement(MoonIcon, { className: "w-5 h-5" }) : React.createElement(SunIcon, { className: "w-5 h-5" })))));
};

// components/Onboarding.tsx
const Onboarding = ({ onOnboardingComplete }) => {
    const [name, setName] = useState('');
    const [animationStep, setAnimationStep] = useState(0);
    const [placeholder, setPlaceholder] = useState('Enter your name...');
    const [isInputFocused, setIsInputFocused] = useState(false);
    const welcomeText = "I'll be your AI conversation partner. What should I call you?";
    const handleTypingComplete = useCallback(() => {
        setAnimationStep(3);
    }, []);
    const { displayedText: typedWelcomeText, isTyping } = useTypingEffect(animationStep >= 2 ? welcomeText : '', 40, handleTypingComplete);
    useEffect(() => {
        audioService.playOnboardingWelcome();
        const timers = [
            setTimeout(() => setAnimationStep(1), 500),
            setTimeout(() => setAnimationStep(2), 1500),
        ];
        return () => timers.forEach(clearTimeout);
    }, []);
    useEffect(() => {
        let placeholderTimeout;
        if (animationStep >= 3) {
            placeholderTimeout = setTimeout(() => {
                setPlaceholder('Or your nickname üòâ');
            }, 2000);
        }
        return () => clearTimeout(placeholderTimeout);
    }, [animationStep]);
    const handleNameSubmit = (e) => {
        e.preventDefault();
        if (name.trim()) {
            audioService.playTransition();
            onOnboardingComplete({ name: name.trim(), goal: LearningGoal.GENERAL, avatarId: 'orion' });
        }
    };
    const handleInputChange = (e) => {
        audioService.playKeypress();
        setName(e.target.value);
    };
    const baseTransition = 'transition-all duration-1000 ease-out';
    const getAnimationClass = (step) => {
        return animationStep >= step ? 'opacity-100 translate-y-0' : 'opacity-0 translate-y-5';
    };
    return (React.createElement("div", { className: "relative min-h-screen flex items-center justify-center p-4 text-white overflow-hidden" },
        React.createElement("div", { className: "absolute inset-0 bg-gradient-to-br from-[#1e1b4b] via-[#0f172a] to-[#312e81] animate-[gradient-animation_20s_ease_infinite]", style: { backgroundSize: '200% 200%' } }),
        React.createElement("div", { className: "absolute top-1/2 left-1/2 w-[800px] h-[800px] bg-purple-500/20 rounded-full blur-3xl", style: { animation: 'moving-glow 30s infinite linear' } }),
        React.createElement("div", { className: "relative z-10 w-full max-w-lg mx-auto text-center space-y-8" },
            React.createElement("h1", { className: `text-6xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-slate-100 to-purple-300 drop-shadow-lg ${baseTransition} ${getAnimationClass(1)}` }, "TalkMaster"),
            React.createElement("div", { className: `flex flex-col items-center space-y-4 ${baseTransition} delay-500 ${getAnimationClass(2)}` },
                React.createElement("div", { className: "relative" },
                    React.createElement("div", { className: "absolute inset-0 bg-purple-400/50 rounded-full blur-xl", style: { animation: 'avatar-pulse 3s infinite ease-in-out' } }),
                    React.createElement("div", { className: "relative w-24 h-24 p-2 bg-slate-800/50 border-2 border-slate-500/50 rounded-full flex items-center justify-center" },
                        React.createElement(BotHeadIcon, { className: "w-12 h-12 text-slate-200" }))),
                React.createElement("p", { className: "text-xl h-14 text-slate-300 font-medium" },
                    typedWelcomeText,
                    isTyping && React.createElement("span", { className: "inline-block w-0.5 h-5 ml-1 bg-purple-300 animate-pulse" }))),
            React.createElement("form", { onSubmit: handleNameSubmit, className: `space-y-4 ${baseTransition} delay-1000 ${getAnimationClass(3)}` },
                React.createElement("div", { className: "relative" },
                    React.createElement("input", { type: "text", value: name, onChange: handleInputChange, onFocus: () => setIsInputFocused(true), onBlur: () => setIsInputFocused(false), className: "w-full max-w-sm px-5 py-4 text-xl text-center text-white bg-white/5 backdrop-blur-md rounded-full border border-white/10 focus:outline-none focus:ring-2 focus:ring-purple-400 placeholder:text-slate-400 transition-all duration-300", placeholder: placeholder }),
                    React.createElement("div", { className: `absolute inset-0 rounded-full pointer-events-none transition-all duration-300 ${isInputFocused ? 'shadow-[0_0_20px_5px_rgba(192,132,252,0.3)]' : ''}` })),
                React.createElement("button", { type: "submit", disabled: !name.trim(), onMouseEnter: () => audioService.playButtonHover(), className: "w-full max-w-sm px-8 py-4 text-lg font-bold text-white transition-all duration-300 transform rounded-full bg-gradient-to-r from-teal-400 to-purple-500 hover:scale-105 shadow-lg hover:shadow-purple-500/30 disabled:from-slate-500 disabled:to-slate-600 disabled:hover:scale-100 disabled:shadow-none disabled:cursor-not-allowed active:scale-100" }, "Continue")))));
};

// ... other components would be fully defined here ...

// App.tsx
const getInitialTheme = () => {
    if (typeof window !== 'undefined' && window.localStorage) {
        const storedPrefs = window.localStorage.getItem('theme');
        if (storedPrefs === 'light' || storedPrefs === 'dark') {
            return storedPrefs;
        }
        const userMedia = window.matchMedia('(prefers-color-scheme: dark)');
        if (userMedia.matches) {
            return 'dark';
        }
    }
    return 'light';
};
const App = () => {
    const [userProfile, setUserProfile] = useState(() => userService.getUserProfile());
    const [theme, setTheme] = useState(getInitialTheme());
    const [view, setView] = useState(View.DASHBOARD);
    const [scenarios, setScenarios] = useState([]);
    const [selectedScenario, setSelectedScenario] = useState(null);
    const [conversationResult, setConversationResult] = useState(null);
    const [userLevel, setUserLevel] = useState(UserLevel.Intermediate);
    const [selectedVoice, setSelectedVoice] = useState(VOICES[0]);
    const [interactionMode, setInteractionMode] = useState(InteractionMode.LIVE);
    const [userRole, setUserRole] = useState('default');
    const [xp, setXp] = useState(0);
    const [isSoundEnabled, setIsSoundEnabled] = useState(!audioService.isMuted);
    const [newlyUnlockedAchievement, setNewlyUnlockedAchievement] = useState(null);
    const [isStartModalOpen, setIsStartModalOpen] = useState(false);
    const [selectedAvatarId, setSelectedAvatarId] = useState(userProfile?.avatarId || 'orion');
    const [isGlowing, setIsGlowing] = useState(false);
    const userAppLevel = Math.floor(xp / 100) + 1;
    const isInitialMount = useRef(true);
    const conversationStartTime = useRef(null);
    const loadScenarios = useCallback(() => {
        setScenarios(scenarioService.getAllScenarios());
    }, []);
    const loadInitialStats = useCallback(() => {
        const stats = achievementService.getStats();
        const quests = questService.getQuests();
        const claimedXp = quests.filter(q => q.isClaimed).reduce((sum, q) => sum + q.xp, 0);
        setXp(stats.conversationsCompleted * 10 + stats.dailyQuestsCompleted * 25 + 150 + claimedXp);
    }, []);
    const handleOnboardingComplete = useCallback((profile) => {
        userService.saveUserProfile(profile);
        setUserProfile(profile);
        setSelectedAvatarId(profile.avatarId);
        audioService.playWelcome();
    }, []);
    useEffect(() => {
        loadScenarios();
        if (userProfile) {
            setSelectedAvatarId(userProfile.avatarId);
            achievementService.checkAndResetStreak();
            loadInitialStats();
        }
        else {
            setXp(0);
        }
    }, [userProfile, loadScenarios, loadInitialStats]);
    useEffect(() => {
        if (theme === 'dark') {
            document.documentElement.classList.add('dark');
            localStorage.setItem('theme', 'dark');
        }
        else {
            document.documentElement.classList.remove('dark');
            localStorage.setItem('theme', 'light');
        }
    }, [theme]);
    useEffect(() => {
        if (isInitialMount.current) {
            isInitialMount.current = false;
        }
        else {
            if (userProfile)
                audioService.playTransition();
        }
    }, [view, userProfile]);
    useEffect(() => {
        if (isStartModalOpen) {
            document.body.style.overflow = 'hidden';
        }
        else {
            document.body.style.overflow = '';
        }
        return () => {
            document.body.style.overflow = '';
        };
    }, [isStartModalOpen]);
    const toggleTheme = useCallback(() => {
        setTheme(prevTheme => (prevTheme === 'light' ? 'dark' : 'light'));
    }, []);
    const toggleSound = useCallback(() => {
        audioService.toggleMute();
        setIsSoundEnabled(prevState => !prevState);
    }, []);
    const handleOpenStartModal = useCallback((scenario) => {
        setSelectedScenario(scenario);
        setIsStartModalOpen(true);
    }, []);
    const handleCloseStartModal = useCallback(() => {
        setIsStartModalOpen(false);
        setSelectedScenario(null);
    }, []);
    const handleStartConversation = useCallback((mode, role) => {
        setInteractionMode(mode);
        setUserRole(role);
        setIsStartModalOpen(false);
        conversationStartTime.current = Date.now();
        setView(View.CONVERSATION);
    }, []);
    const handleConversationEnd = useCallback((result) => {
        const durationInSeconds = conversationStartTime.current ? Math.round((Date.now() - conversationStartTime.current) / 1000) : 0;
        const fullResult = { ...result, duration: durationInSeconds };
        if (fullResult.earnedXp > 0) {
            audioService.playSuccess();
        }
        setXp(prevXp => prevXp + fullResult.earnedXp);
        const wasFlawless = interactionMode === InteractionMode.TEXT && fullResult.messages.length > 0
            ? fullResult.messages.filter(m => m.speaker === Speaker.User).every(m => m.feedback === 'Great job!')
            : false;
        const newAchievement = achievementService.updateStatsAndCheckAchievements({
            scenarioId: fullResult.scenario.id,
            wasFlawless,
        });
        questService.updateQuestProgress(QuestType.COMPLETE_ANY_SCENARIO, 1);
        questService.updateQuestProgress(QuestType.COMPLETE_SPECIFIC_SCENARIO, fullResult.scenario.id);
        if (durationInSeconds > 0) {
            questService.updateQuestProgress(QuestType.CONVERSE_FOR_MINUTES, durationInSeconds);
        }
        if (newAchievement) {
            audioService.playAchievementUnlock();
            setNewlyUnlockedAchievement(newAchievement);
            setIsGlowing(true);
            setTimeout(() => setIsGlowing(false), 1500);
        }
        setConversationResult(fullResult);
        setView(View.CONVERSATION_SUMMARY);
        setSelectedScenario(null);
        conversationStartTime.current = null;
    }, [interactionMode]);
    const handleClaimQuestReward = useCallback((questId) => {
        const { xpGained } = questService.claimReward(questId);
        if (xpGained > 0) {
            audioService.playSuccess();
            setXp(prev => prev + xpGained);
        }
    }, []);
    const handleCloseToast = useCallback(() => {
        setNewlyUnlockedAchievement(null);
    }, []);
    const handleShowLearnAndReview = useCallback(() => {
        setView(View.LEARN_REVIEW);
    }, []);
    const handleShowSettings = useCallback(() => {
        setView(View.SETTINGS);
    }, []);
    const handleBackToDashboard = useCallback(() => {
        setView(View.DASHBOARD);
        setConversationResult(null);
    }, []);
    const handleScenarioCreated = useCallback(() => {
        loadScenarios();
    }, [loadScenarios]);
    const handleSelectAvatar = useCallback((avatarId) => {
        if (userProfile) {
            const updatedProfile = { ...userProfile, avatarId };
            setUserProfile(updatedProfile);
            userService.saveUserProfile(updatedProfile);
            setSelectedAvatarId(avatarId);
        }
    }, [userProfile]);
    const handleUpdateProfile = useCallback((updatedProfileData) => {
        if (userProfile) {
            const updatedProfile = { ...userProfile, ...updatedProfileData };
            setUserProfile(updatedProfile);
            userService.saveUserProfile(updatedProfile);
        }
    }, [userProfile]);
    const handleClearVocabulary = useCallback(() => {
        vocabularyService.clearVocabularyItems();
    }, []);
    const handleClearCorrections = useCallback(() => {
        reviewService.clearReviewItems();
    }, []);
    const handleResetApp = useCallback(() => {
        const keysToRemove = [
            'talkmaster_user_profile',
            'theme',
            'soundMuted',
            'talkmaster_stats',
            'talkmaster_unlocked_achievements',
            'talkmaster_review_items',
            'talkmaster_vocabulary_items',
            'talkmaster_custom_scenarios',
            'talkmaster_daily_quests',
            'talkmaster_quests_date',
        ];
        keysToRemove.forEach(key => {
            try {
                localStorage.removeItem(key);
            }
            catch (e) {
                console.error(`Failed to remove key ${key}:`, e);
            }
        });
        try {
            localStorage.clear();
        }
        catch (e) {
            console.error('Failed to clear localStorage:', e);
        }
        window.location.reload();
    }, []);
    if (!userProfile) {
        return React.createElement(Onboarding, { onOnboardingComplete: handleOnboardingComplete });
    }
    return (React.createElement("div", { className: `min-h-screen text-slate-800 transition-colors duration-300 dark:text-slate-200` },
        isGlowing && React.createElement("div", { className: "achievement-sparkle" }),
        React.createElement("div", { className: "container max-w-4xl min-h-screen p-4 mx-auto md:p-6" },
            React.createElement(Header, { userLevel: userAppLevel, xp: xp, theme: theme, toggleTheme: toggleTheme, isSoundEnabled: isSoundEnabled, toggleSound: toggleSound, onShowLearnAndReview: handleShowLearnAndReview, onShowSettings: handleShowSettings }),
            React.createElement("main", { className: "mt-4" },
                view === View.DASHBOARD && (React.createElement(Dashboard, { userName: userProfile.name, scenarios: scenarios, onScenarioSelect: handleOpenStartModal, onScenarioCreated: handleScenarioCreated, onClaimQuestReward: handleClaimQuestReward, selectedAvatarId: selectedAvatarId, onSelectAvatar: handleSelectAvatar })),
                view === View.CONVERSATION && selectedScenario && (React.createElement(ConversationRouter, { scenario: selectedScenario, userLevel: userLevel, onConversationEnd: handleConversationEnd, voice: selectedVoice, interactionMode: interactionMode, userRole: userRole, selectedAvatarId: selectedAvatarId })),
                view === View.CONVERSATION_SUMMARY && conversationResult && (React.createElement(ConversationSummary, { result: conversationResult, onClose: handleBackToDashboard })),
                view === View.LEARN_REVIEW && (React.createElement(LearnAndReview, { onBack: handleBackToDashboard })),
                view === View.SETTINGS && (React.createElement(SettingsView, { userProfile: userProfile, onUpdateProfile: handleUpdateProfile, onBack: handleBackToDashboard, onClearVocabulary: handleClearVocabulary, onClearCorrections: handleClearCorrections, onResetApp: handleResetApp }))),
            newlyUnlockedAchievement && (React.createElement(AchievementToast, { achievement: newlyUnlockedAchievement, onClose: handleCloseToast })),
            isStartModalOpen && selectedScenario && (React.createElement(StartConversationModal, { scenario: selectedScenario, onClose: handleCloseStartModal, onStart: handleStartConversation })))));
};

// index.tsx
const rootElement = document.getElementById('root');
if (!rootElement) {
    throw new Error("Could not find root element to mount to");
}
const root = ReactDOM.createRoot(rootElement);
root.render(React.createElement(React.StrictMode, null, React.createElement(App, null)));
</script>
  </body>
</html>